---
# ===========================================
# ğŸ¤– AIè‡ªåŠ¨è°ƒåº¦é…ç½® (å¿…éœ€)
# ===========================================
ruleName: "fastadmin-multitemplate-standards"
description: "FastAdmin LDCMSå¤šæ¨¡æ¿ç³»ç»Ÿå¼€å‘æ ‡å‡†è§„èŒƒï¼Œæ”¯æŒå¤šå¥—ä¸»é¢˜æ¨¡æ¿å’Œè‡ªå®šä¹‰æ¨¡æ¿å¼€å‘"
version: "1.0.0"
lastUpdated: "2024-12-19"

alwaysApply: false
priority: 8

# ===========================================
# ğŸ” æ™ºèƒ½æ£€æµ‹é…ç½® (æ ¸å¿ƒ)
# ===========================================
detection:
  keywords:
    primary: ["æ¨¡æ¿", "template", "å¤šæ¨¡æ¿", "ä¸»é¢˜"]
    secondary: ["default", "ldcms2024", "ldcms2025", "view", "theme"]
    technical: ["TemplateManager", "{ldcms:", "renderLdcmsTemplate", "getTemplate"]
  
  paths:
    exact: ["addons/ldcms/view/", "view/", "template/"]
    pattern: ["**/view/**", "**/template/**", "**/theme/**"]
  
  contexts:
    development_phase: ["æ¨¡æ¿å¼€å‘", "ä¸»é¢˜å®šåˆ¶", "å‰ç«¯å¼€å‘"]
    project_type: ["æ¨¡æ¿ç³»ç»Ÿ", "ä¸»é¢˜å¼€å‘", "å‰ç«¯å®šåˆ¶"]
    user_intent: ["æ¨¡æ¿å®šåˆ¶", "ä¸»é¢˜åˆ‡æ¢", "ç•Œé¢ç¾åŒ–", "å‰ç«¯ä¼˜åŒ–"]

# ===========================================
# âš¡ è§¦å‘æ¡ä»¶é…ç½® (ç²¾ç¡®)
# ===========================================
triggers:
  explicit_mentions:
    exact_match: ["æ¨¡æ¿", "å¤šæ¨¡æ¿", "ä¸»é¢˜", "æ¨¡æ¿ç³»ç»Ÿ", "template"]
    fuzzy_match: ["ç•Œé¢å®šåˆ¶", "å‰ç«¯æ¨¡æ¿", "ç½‘ç«™ä¸»é¢˜", "é¡µé¢æ¨¡æ¿"]
  
  file_operations:
    reading: ["addons/ldcms/view/ç›®å½•ä¸‹çš„æ¨¡æ¿æ–‡ä»¶"]
    editing: ["HTMLæ¨¡æ¿æ–‡ä»¶", "CSSæ ·å¼æ–‡ä»¶", "JSè„šæœ¬æ–‡ä»¶"]
    creating: ["æ–°çš„æ¨¡æ¿å¥—ä»¶", "è‡ªå®šä¹‰ä¸»é¢˜", "é¡µé¢æ¨¡æ¿"]
  
  code_patterns:
    namespaces: ["addons\\ldcms\\view"]
    functions: ["renderLdcmsTemplate", "getTemplate", "setTemplate", "loadTemplate"]
    classes: ["TemplateManager", "ThemeConfig", "ViewEngine"]
    comments: ["æ¨¡æ¿", "template", "ä¸»é¢˜", "theme"]
  
  intent_analysis:
    primary_intent: ["template_development", "theme_customization", "frontend_design"]
    secondary_intent: ["template_switching", "ui_customization", "responsive_design"]
    complexity_level: ["medium", "complex"]

# ===========================================
# ğŸ”— å…³è”è§„åˆ™é…ç½®
# ===========================================
relationships:
  required_with: ["ldcms-enterprise-cms-standards.mdc"]
  recommended_with: ["bootstrap-adminlte-ui-standards.mdc", "fastadmin-multilanguage-standards.mdc"]
  depends_on: ["common-rules.mdc"]

# ===========================================
# ğŸ“Š ä½¿ç”¨åœºæ™¯æè¿° (å¸®åŠ©AIç†è§£)
# ===========================================
use_cases:
  primary:
    - scenario: "ç”¨æˆ·éœ€è¦å¼€å‘æ–°çš„æ¨¡æ¿å¥—ä»¶"
      trigger_example: "å¦‚ä½•ä¸ºLDCMSåˆ›å»ºä¸€ä¸ªæ–°çš„ä¼ä¸šæ¨¡æ¿ï¼Ÿ"
      expected_behavior: "AIåº”è¯¥æä¾›å®Œæ•´çš„æ¨¡æ¿å¼€å‘æŒ‡å—ï¼ŒåŒ…æ‹¬ç›®å½•ç»“æ„ã€å‘½åè§„èŒƒã€æ ‡ç­¾ä½¿ç”¨"
    - scenario: "ç”¨æˆ·è¦å®šåˆ¶ç°æœ‰æ¨¡æ¿"
      trigger_example: "æ€ä¹ˆä¿®æ”¹defaultæ¨¡æ¿çš„é¦–é¡µå¸ƒå±€ï¼Ÿ"
      expected_behavior: "AIåº”è¯¥æä¾›æ¨¡æ¿å®šåˆ¶çš„å…·ä½“æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹"
  
  secondary:
    - scenario: "ç”¨æˆ·é‡åˆ°æ¨¡æ¿æ¸²æŸ“é—®é¢˜"
      trigger_example: "LDCMSæ¨¡æ¿æ ‡ç­¾ä¸ç”Ÿæ•ˆ"
      expected_behavior: "AIåº”è¯¥åŸºäºæ¨¡æ¿è§„èŒƒæä¾›æ’é”™å’Œè§£å†³æ–¹æ¡ˆ"
    - scenario: "ç”¨æˆ·éœ€è¦å®ç°æ¨¡æ¿åˆ‡æ¢åŠŸèƒ½"
      trigger_example: "å¦‚ä½•è®©ç”¨æˆ·åœ¨å‰å°é€‰æ‹©ä¸åŒä¸»é¢˜ï¼Ÿ"
      expected_behavior: "AIåº”è¯¥æä¾›æ¨¡æ¿åˆ‡æ¢çš„å®ç°æ–¹æ³•"

# ===========================================
# ğŸ¯ AIæŒ‡ä»¤é…ç½® (æ˜ç¡®æŒ‡å¯¼)
# ===========================================
ai_instructions:
  when_to_load: "å½“ç”¨æˆ·æåŠæ¨¡æ¿ã€ä¸»é¢˜ã€templateã€å‰ç«¯å®šåˆ¶ï¼Œæˆ–æ“ä½œview/ç›®å½•æ—¶åº”ç«‹å³åŠ è½½æ­¤è§„åˆ™"
  how_to_apply: "ä¸¥æ ¼æŒ‰ç…§å¤šæ¨¡æ¿å¼€å‘è§„èŒƒæä¾›å»ºè®®ï¼Œç¡®ä¿æ¨¡æ¿ç»“æ„ã€æ ‡ç­¾ä½¿ç”¨ã€æ ·å¼è§„èŒƒçš„ä¸€è‡´æ€§"
  priority_reason: "å¤šæ¨¡æ¿ç³»ç»Ÿæ˜¯LDCMSçš„é‡è¦ç‰¹æ€§ï¼Œå½±å“ç”¨æˆ·ä½“éªŒå’Œç½‘ç«™å¤–è§‚"
  coordination: "ä¸LDCMSæ ¸å¿ƒè§„èŒƒå’Œå¤šè¯­è¨€è§„èŒƒåè°ƒï¼Œç¡®ä¿æ¨¡æ¿ä¸è¯­è¨€ç³»ç»Ÿçš„å…¼å®¹æ€§"

# ===========================================
# ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–é…ç½®
# ===========================================
performance:
  preload_conditions: ["æ£€æµ‹åˆ°é¡¹ç›®åŒ…å«view/ç›®å½•", "ç”¨æˆ·å†å²æ“ä½œæ¶‰åŠæ¨¡æ¿å¼€å‘"]
  cache_duration: "20"
  unload_conditions: ["è¿ç»­5æ¬¡å¯¹è¯æœªæ¶‰åŠæ¨¡æ¿ç›¸å…³å†…å®¹"]
---
# FastAdmin LDCMS å¤šæ¨¡æ¿ç³»ç»Ÿå¼€å‘æ ‡å‡†è§„èŒƒ

> **ğŸ¯ ä¸“ä¸ºLDCMSæ’ä»¶è®¾è®¡**: åŸºäºFastAdmin LDCMSä¼ä¸šç½‘ç«™ç®¡ç†ç³»ç»Ÿçš„å¤šæ¨¡æ¿å¼€å‘è§„èŒƒ
> **ğŸ“ æ¨¡æ¿ä½ç½®**: `addons/ldcms/view/` ç›®å½•ä¸‹çš„å¤šå¥—æ¨¡æ¿
> **ğŸ¨ ç°æœ‰æ¨¡æ¿**: defaultã€enã€ldcms2024ã€ldcms2024enã€ldcms2025ã€ldcms2025en
> **ğŸ”§ æ¨¡æ¿å¼•æ“**: ThinkPHP Template + LDCMSè‡ªå®šä¹‰æ ‡ç­¾ç³»ç»Ÿ
> **âš ï¸ é‡è¦**: æ‰€æœ‰æ¨¡æ¿å¼€å‘éƒ½å¿…é¡»åŸºäºLDCMSæ’ä»¶çš„ç°æœ‰æ¨¡æ¿ç»“æ„è¿›è¡Œ

---

## ğŸ¨ æ¨¡æ¿ç³»ç»Ÿæ¶æ„

## ğŸš¨ LDCMSæ¨¡æ¿å¼€å‘å¼ºåˆ¶è¦æ±‚

**æ‰€æœ‰æ¨¡æ¿å¼€å‘å¿…é¡»éµå¾ªä»¥ä¸‹LDCMSæ’ä»¶è§„èŒƒï¼š**

1. **ğŸ”¥ ä½¿ç”¨LDCMSç°æœ‰æ¨¡æ¿ç»“æ„**: å¿…é¡»åŸºäº `addons/ldcms/view/` ä¸‹çš„ç°æœ‰æ¨¡æ¿è¿›è¡Œå¼€å‘
2. **ğŸ”¥ éµå¾ªLDCMSæ¨¡æ¿å‘½åè§„èŒƒ**: defaultã€enã€ldcms2024ã€ldcms2025ç­‰å‘½åæ–¹å¼
3. **ğŸ”¥ ä½¿ç”¨LDCMSæ ‡ç­¾ç³»ç»Ÿ**: å¿…é¡»ä½¿ç”¨ `{ldcms:}` æ ‡ç­¾ç³»ç»Ÿï¼Œä¸èƒ½ä½¿ç”¨å…¶ä»–æ ‡ç­¾
4. **ğŸ”¥ ä¿æŒæ¨¡æ¿å…¼å®¹æ€§**: æ–°æ¨¡æ¿å¿…é¡»ä¸ç°æœ‰LDCMSåŠŸèƒ½å®Œå…¨å…¼å®¹
5. **ğŸ”¥ éµå¾ªå¤šè¯­è¨€æ¨¡æ¿ç»“æ„**: æ¯ä¸ªä¸»é¢˜éƒ½è¦æœ‰å¯¹åº”çš„è¯­è¨€ç‰ˆæœ¬

### LDCMSæ’ä»¶ç°æœ‰æ¨¡æ¿ç›®å½•ç»“æ„ï¼ˆå®é™…é¡¹ç›®ç»“æ„ï¼‰
```
addons/ldcms/view/                    # LDCMSæ¨¡æ¿æ ¹ç›®å½•
â”œâ”€â”€ ğŸ“ default/                       # é»˜è®¤ä¸­æ–‡æ¨¡æ¿ â­
â”‚   â”œâ”€â”€ ğŸ“ index/                     # é¦–é¡µæ¨¡æ¿
â”‚   â”œâ”€â”€ ğŸ“ lists/                     # åˆ—è¡¨é¡µæ¨¡æ¿
â”‚   â”œâ”€â”€ ğŸ“ detail/                    # è¯¦æƒ…é¡µæ¨¡æ¿
â”‚   â”œâ”€â”€ ğŸ“ search/                    # æœç´¢æ¨¡æ¿
â”‚   â”œâ”€â”€ ğŸ“ form/                      # è¡¨å•æ¨¡æ¿
â”‚   â””â”€â”€ ğŸ“ common/                    # å…¬å…±æ¨¡æ¿
â”œâ”€â”€ ğŸ“ en/                            # è‹±æ–‡æ¨¡æ¿ â­
â”‚   â””â”€â”€ (ä¸defaultç»“æ„ç›¸åŒ)
â”œâ”€â”€ ğŸ“ ldcms2024/                     # 2024ä¸»é¢˜ä¸­æ–‡ç‰ˆ â­
â”‚   â””â”€â”€ (ç°ä»£åŒ–è®¾è®¡é£æ ¼)
â”œâ”€â”€ ğŸ“ ldcms2024en/                   # 2024ä¸»é¢˜è‹±æ–‡ç‰ˆ â­
â”‚   â””â”€â”€ (2024ä¸»é¢˜çš„è‹±æ–‡ç‰ˆæœ¬)
â”œâ”€â”€ ğŸ“ ldcms2025/                     # 2025ä¸»é¢˜ä¸­æ–‡ç‰ˆ â­
â”‚   â””â”€â”€ (æœ€æ–°è®¾è®¡é£æ ¼)
â””â”€â”€ ğŸ“ ldcms2025en/                   # 2025ä¸»é¢˜è‹±æ–‡ç‰ˆ â­
    â””â”€â”€ (2025ä¸»é¢˜çš„è‹±æ–‡ç‰ˆæœ¬)

æ³¨æ„ï¼šâ­ æ ‡è®°çš„æ˜¯å·²å®‰è£…çš„æ¨¡æ¿ï¼Œå¼€å‘æ—¶å¿…é¡»åŸºäºè¿™äº›ç°æœ‰æ¨¡æ¿è¿›è¡Œ
```

### LDCMSæ¨¡æ¿æ–‡ä»¶æ ‡å‡†ç»“æ„
```
æ¯ä¸ªæ¨¡æ¿ç›®å½•åŒ…å«ï¼š
â”œâ”€â”€ ğŸ“„ index.html                     # é¦–é¡µæ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ lists.html                     # åˆ—è¡¨é¡µæ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ detail.html                    # è¯¦æƒ…é¡µæ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ search.html                    # æœç´¢é¡µæ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ form.html                      # è¡¨å•é¡µæ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ ğŸ“ static/                        # é™æ€èµ„æºç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ css/                       # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ js/                        # JavaScriptæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ images/                    # å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ ğŸ“ fonts/                     # å­—ä½“æ–‡ä»¶
â””â”€â”€ ğŸ“„ config.php                     # æ¨¡æ¿é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
```

### æ¨¡æ¿é…ç½®æ–‡ä»¶è§„èŒƒ
```php
// config.php - æ¨¡æ¿é…ç½®æ–‡ä»¶
<?php
return [
    // æ¨¡æ¿åŸºæœ¬ä¿¡æ¯
    'name' => 'default',
    'title' => 'é»˜è®¤æ¨¡æ¿',
    'description' => 'LDCMSé»˜è®¤æ¨¡æ¿ï¼Œæ”¯æŒå“åº”å¼è®¾è®¡',
    'version' => '1.0.0',
    'author' => 'LDCMS Team',
    'website' => 'https://www.ldcms.com',
    'email' => 'support@ldcms.com',
    
    // æ¨¡æ¿ç‰¹æ€§
    'features' => [
        'responsive' => true,        // å“åº”å¼è®¾è®¡
        'multilang' => true,         // å¤šè¯­è¨€æ”¯æŒ
        'seo_friendly' => true,      // SEOå‹å¥½
        'rtl_support' => false,      // RTLæ”¯æŒ
        'dark_mode' => false,        // æš—é»‘æ¨¡å¼
        'custom_colors' => true,     // è‡ªå®šä¹‰é¢œè‰²
        'custom_fonts' => true,      // è‡ªå®šä¹‰å­—ä½“
    ],
    
    // å…¼å®¹æ€§è¦æ±‚
    'requirements' => [
        'ldcms_version' => '>=1.4.0',
        'php_version' => '>=7.4.0',
        'mysql_version' => '>=5.7.0',
    ],
    
    // æ¨¡æ¿è®¾ç½®é€‰é¡¹
    'settings' => [
        'layout' => [
            'type' => 'select',
            'title' => 'å¸ƒå±€æ–¹å¼',
            'options' => [
                'full' => 'å…¨å®½å¸ƒå±€',
                'boxed' => 'ç›’å¼å¸ƒå±€',
                'fluid' => 'æµä½“å¸ƒå±€'
            ],
            'default' => 'full'
        ],
        'primary_color' => [
            'type' => 'color',
            'title' => 'ä¸»è‰²è°ƒ',
            'default' => '#3498db'
        ],
        'secondary_color' => [
            'type' => 'color',
            'title' => 'è¾…åŠ©è‰²',
            'default' => '#2ecc71'
        ],
        'font_family' => [
            'type' => 'select',
            'title' => 'å­—ä½“æ—',
            'options' => [
                'system' => 'ç³»ç»Ÿå­—ä½“',
                'google' => 'Google Fonts',
                'custom' => 'è‡ªå®šä¹‰å­—ä½“'
            ],
            'default' => 'system'
        ],
        'show_breadcrumb' => [
            'type' => 'switch',
            'title' => 'æ˜¾ç¤ºé¢åŒ…å±‘å¯¼èˆª',
            'default' => true
        ],
        'show_sidebar' => [
            'type' => 'switch',
            'title' => 'æ˜¾ç¤ºä¾§è¾¹æ ',
            'default' => true
        ]
    ],
    
    // è‡ªå®šä¹‰åŒºåŸŸ
    'regions' => [
        'header_top' => 'å¤´éƒ¨é¡¶éƒ¨åŒºåŸŸ',
        'header_bottom' => 'å¤´éƒ¨åº•éƒ¨åŒºåŸŸ',
        'sidebar_left' => 'å·¦ä¾§è¾¹æ ',
        'sidebar_right' => 'å³ä¾§è¾¹æ ',
        'footer_top' => 'åº•éƒ¨é¡¶éƒ¨åŒºåŸŸ',
        'footer_bottom' => 'åº•éƒ¨åº•éƒ¨åŒºåŸŸ'
    ],
    
    // é¡µé¢æ¨¡æ¿æ˜ å°„
    'page_templates' => [
        'index' => 'index/index.html',
        'category' => 'lists/index.html',
        'document' => 'detail/index.html',
        'search' => 'search/index.html',
        'form' => 'form/index.html',
        '404' => 'error/404.html',
        '500' => 'error/500.html'
    ]
];
```

```json
// template.json - æ¨¡æ¿å…ƒä¿¡æ¯
{
    "name": "default",
    "title": "é»˜è®¤æ¨¡æ¿",
    "description": "LDCMSé»˜è®¤æ¨¡æ¿ï¼Œé€‚ç”¨äºä¼ä¸šç½‘ç«™å’Œå†…å®¹ç®¡ç†",
    "version": "1.0.0",
    "author": "LDCMS Team",
    "website": "https://www.ldcms.com",
    "license": "MIT",
    "tags": ["responsive", "business", "cms"],
    "preview": "preview.jpg",
    "screenshots": [
        "screenshot1.jpg",
        "screenshot2.jpg",
        "screenshot3.jpg"
    ],
    "demo_url": "https://demo.ldcms.com/default",
    "support_url": "https://support.ldcms.com",
    "changelog": [
        {
            "version": "1.0.0",
            "date": "2024-01-01",
            "changes": ["åˆå§‹ç‰ˆæœ¬å‘å¸ƒ"]
        }
    ]
}
```

---

## ğŸ› ï¸ æ¨¡æ¿ç®¡ç†å™¨å¼€å‘

### æ¨¡æ¿ç®¡ç†æ ¸å¿ƒç±»
```php
/**
 * æ¨¡æ¿ç®¡ç†å™¨
 */
class TemplateManager
{
    private static $templates = [];
    private static $currentTemplate = null;
    private static $templateSettings = [];
    
    /**
     * åˆå§‹åŒ–æ¨¡æ¿ç³»ç»Ÿ
     */
    public static function initialize()
    {
        self::loadTemplates();
        self::setCurrentTemplate();
        self::loadTemplateSettings();
    }
    
    /**
     * åŠ è½½æ‰€æœ‰æ¨¡æ¿
     */
    public static function loadTemplates()
    {
        $templatePath = ADDON_PATH . 'ldcms/view/';
        $directories = glob($templatePath . '*', GLOB_ONLYDIR);
        
        foreach ($directories as $dir) {
            $templateName = basename($dir);
            $configFile = $dir . '/config.php';
            $jsonFile = $dir . '/template.json';
            
            if (file_exists($configFile)) {
                $config = include $configFile;
                $config['path'] = $dir;
                $config['url'] = '/addons/ldcms/view/' . $templateName;
                
                // åˆå¹¶JSONä¿¡æ¯
                if (file_exists($jsonFile)) {
                    $jsonInfo = json_decode(file_get_contents($jsonFile), true);
                    $config = array_merge($config, $jsonInfo);
                }
                
                self::$templates[$templateName] = $config;
            }
        }
    }
    
    /**
     * è·å–æ‰€æœ‰æ¨¡æ¿
     */
    public static function getTemplates()
    {
        return self::$templates;
    }
    
    /**
     * è·å–å¯ç”¨æ¨¡æ¿
     */
    public static function getAvailableTemplates()
    {
        $templates = [];
        foreach (self::$templates as $name => $config) {
            if (self::isTemplateCompatible($config)) {
                $templates[$name] = $config;
            }
        }
        return $templates;
    }
    
    /**
     * æ£€æŸ¥æ¨¡æ¿å…¼å®¹æ€§
     */
    public static function isTemplateCompatible($config)
    {
        // æ£€æŸ¥LDCMSç‰ˆæœ¬
        if (isset($config['requirements']['ldcms_version'])) {
            $requiredVersion = $config['requirements']['ldcms_version'];
            $currentVersion = get_addon_info('ldcms')['version'];
            
            if (!version_compare($currentVersion, str_replace('>=', '', $requiredVersion), '>=')) {
                return false;
            }
        }
        
        // æ£€æŸ¥PHPç‰ˆæœ¬
        if (isset($config['requirements']['php_version'])) {
            $requiredVersion = str_replace('>=', '', $config['requirements']['php_version']);
            if (!version_compare(PHP_VERSION, $requiredVersion, '>=')) {
                return false;
            }
        }
        
        return true;
    }
    
    /**
     * è®¾ç½®å½“å‰æ¨¡æ¿
     */
    public static function setCurrentTemplate($templateName = null)
    {
        if ($templateName === null) {
            $templateName = self::detectCurrentTemplate();
        }
        
        if (!isset(self::$templates[$templateName])) {
            $templateName = 'default';
        }
        
        self::$currentTemplate = $templateName;
        
        // è®¾ç½®æ¨¡æ¿è·¯å¾„
        $templatePath = ADDON_PATH . 'ldcms/view/' . $templateName . '/';
        config('template.view_path', $templatePath);
        
        return $templateName;
    }
    
    /**
     * æ£€æµ‹å½“å‰æ¨¡æ¿
     */
    private static function detectCurrentTemplate()
    {
        $config = get_addon_config('ldcms');
        $lang = LanguageHandler::getCurrentLanguage();
        
        // æ ¹æ®è¯­è¨€é€‰æ‹©æ¨¡æ¿
        $templateMap = [
            'zh-cn' => $config['template'] ?? 'default',
            'en' => $config['en_template'] ?? 'en',
            'zh-tw' => $config['tw_template'] ?? 'default'
        ];
        
        return $templateMap[$lang] ?? 'default';
    }
    
    /**
     * è·å–å½“å‰æ¨¡æ¿
     */
    public static function getCurrentTemplate()
    {
        return self::$currentTemplate ?: 'default';
    }
    
    /**
     * è·å–æ¨¡æ¿ä¿¡æ¯
     */
    public static function getTemplateInfo($templateName = null)
    {
        $templateName = $templateName ?: self::getCurrentTemplate();
        return self::$templates[$templateName] ?? [];
    }
    
    /**
     * è·å–æ¨¡æ¿è·¯å¾„
     */
    public static function getTemplatePath($templateName = null, $file = '')
    {
        $templateName = $templateName ?: self::getCurrentTemplate();
        $basePath = ADDON_PATH . 'ldcms/view/' . $templateName . '/';
        
        return $file ? $basePath . $file : $basePath;
    }
    
    /**
     * è·å–æ¨¡æ¿URL
     */
    public static function getTemplateUrl($templateName = null, $file = '')
    {
        $templateName = $templateName ?: self::getCurrentTemplate();
        $baseUrl = '/addons/ldcms/view/' . $templateName . '/';
        
        return $file ? $baseUrl . $file : $baseUrl;
    }
    
    /**
     * æ£€æŸ¥æ¨¡æ¿æ–‡ä»¶æ˜¯å¦å­˜åœ¨
     */
    public static function templateFileExists($file, $templateName = null)
    {
        $templatePath = self::getTemplatePath($templateName, $file);
        return file_exists($templatePath);
    }
    
    /**
     * åŠ è½½æ¨¡æ¿è®¾ç½®
     */
    public static function loadTemplateSettings($templateName = null)
    {
        $templateName = $templateName ?: self::getCurrentTemplate();
        $settingsKey = 'template_settings_' . $templateName;
        
        self::$templateSettings[$templateName] = cache($settingsKey) ?: [];
        
        // å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼
        if (empty(self::$templateSettings[$templateName])) {
            $templateInfo = self::getTemplateInfo($templateName);
            $defaultSettings = [];
            
            if (isset($templateInfo['settings'])) {
                foreach ($templateInfo['settings'] as $key => $setting) {
                    $defaultSettings[$key] = $setting['default'] ?? '';
                }
            }
            
            self::$templateSettings[$templateName] = $defaultSettings;
            cache($settingsKey, $defaultSettings, 86400); // ç¼“å­˜24å°æ—¶
        }
    }
    
    /**
     * è·å–æ¨¡æ¿è®¾ç½®
     */
    public static function getTemplateSetting($key, $templateName = null, $default = null)
    {
        $templateName = $templateName ?: self::getCurrentTemplate();
        
        if (!isset(self::$templateSettings[$templateName])) {
            self::loadTemplateSettings($templateName);
        }
        
        return self::$templateSettings[$templateName][$key] ?? $default;
    }
    
    /**
     * è®¾ç½®æ¨¡æ¿é…ç½®
     */
    public static function setTemplateSetting($key, $value, $templateName = null)
    {
        $templateName = $templateName ?: self::getCurrentTemplate();
        
        if (!isset(self::$templateSettings[$templateName])) {
            self::loadTemplateSettings($templateName);
        }
        
        self::$templateSettings[$templateName][$key] = $value;
        
        // æ›´æ–°ç¼“å­˜
        $settingsKey = 'template_settings_' . $templateName;
        cache($settingsKey, self::$templateSettings[$templateName], 86400);
        
        return true;
    }
    
    /**
     * æ‰¹é‡è®¾ç½®æ¨¡æ¿é…ç½®
     */
    public static function setTemplateSettings($settings, $templateName = null)
    {
        $templateName = $templateName ?: self::getCurrentTemplate();
        
        foreach ($settings as $key => $value) {
            self::setTemplateSetting($key, $value, $templateName);
        }
        
        return true;
    }
}
```

### æ¨¡æ¿æ¸²æŸ“å¼•æ“
```php
/**
 * æ¨¡æ¿æ¸²æŸ“å¼•æ“
 */
class TemplateRenderer
{
    private $template;
    private $variables = [];
    private $blocks = [];
    private $extends = null;
    
    /**
     * æ„é€ å‡½æ•°
     */
    public function __construct($template = null)
    {
        $this->template = $template;
    }
    
    /**
     * åˆ†é…å˜é‡
     */
    public function assign($name, $value = null)
    {
        if (is_array($name)) {
            $this->variables = array_merge($this->variables, $name);
        } else {
            $this->variables[$name] = $value;
        }
        
        return $this;
    }
    
    /**
     * æ¸²æŸ“æ¨¡æ¿
     */
    public function render($template = null, $variables = [])
    {
        $template = $template ?: $this->template;
        $this->assign($variables);
        
        // è·å–æ¨¡æ¿æ–‡ä»¶è·¯å¾„
        $templateFile = $this->getTemplateFile($template);
        
        if (!file_exists($templateFile)) {
            throw new \Exception("æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨: {$template}");
        }
        
        // é¢„å¤„ç†æ¨¡æ¿å†…å®¹
        $content = file_get_contents($templateFile);
        $content = $this->preprocessTemplate($content);
        
        // åˆ›å»ºä¸´æ—¶æ–‡ä»¶
        $tempFile = $this->createTempFile($content);
        
        try {
            // æ¸²æŸ“æ¨¡æ¿
            extract($this->variables);
            ob_start();
            include $tempFile;
            $output = ob_get_clean();
            
            // å¤„ç†æ¨¡æ¿ç»§æ‰¿
            if ($this->extends) {
                $output = $this->processExtends($output);
            }
            
            return $output;
            
        } finally {
            // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            if (file_exists($tempFile)) {
                unlink($tempFile);
            }
        }
    }
    
    /**
     * è·å–æ¨¡æ¿æ–‡ä»¶è·¯å¾„
     */
    private function getTemplateFile($template)
    {
        // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä½¿ç”¨å½“å‰æ¨¡æ¿ç›®å½•
        if (strpos($template, '/') !== 0) {
            $templatePath = TemplateManager::getTemplatePath();
            return $templatePath . $template;
        }
        
        return $template;
    }
    
    /**
     * é¢„å¤„ç†æ¨¡æ¿å†…å®¹
     */
    private function preprocessTemplate($content)
    {
        // å¤„ç†æ¨¡æ¿ç»§æ‰¿
        $content = preg_replace_callback(
            '/\{extend\s+name=["\']([^"\']+)["\']\s*\/\}/',
            function($matches) {
                $this->extends = $matches[1];
                return '';
            },
            $content
        );
        
        // å¤„ç†åŒºå—å®šä¹‰
        $content = preg_replace_callback(
            '/\{block\s+name=["\']([^"\']+)["\'].*?\}(.*?)\{\/block\}/s',
            function($matches) {
                $blockName = $matches[1];
                $blockContent = $matches[2];
                $this->blocks[$blockName] = $blockContent;
                return "<?php echo \$this->renderBlock('{$blockName}'); ?>";
            },
            $content
        );
        
        // å¤„ç†åŒ…å«æ–‡ä»¶
        $content = preg_replace_callback(
            '/\{include\s+file=["\']([^"\']+)["\']\s*\/\}/',
            function($matches) {
                $includeFile = $matches[1];
                $includeContent = $this->getIncludeContent($includeFile);
                return $includeContent;
            },
            $content
        );
        
        // å¤„ç†è‡ªå®šä¹‰æ ‡ç­¾
        $content = $this->processCustomTags($content);
        
        return $content;
    }
    
    /**
     * å¤„ç†è‡ªå®šä¹‰æ ‡ç­¾
     */
    private function processCustomTags($content)
    {
        // LDCMSæ ‡ç­¾å¤„ç†
        $content = preg_replace_callback(
            '/\{ldcms:(\w+)\s+(.*?)\}(.*?)\{\/ldcms:\1\}/s',
            function($matches) {
                $tagName = $matches[1];
                $attributes = $matches[2];
                $innerContent = $matches[3];
                
                return $this->processLdcmsTag($tagName, $attributes, $innerContent);
            },
            $content
        );
        
        // å•æ ‡ç­¾å¤„ç†
        $content = preg_replace_callback(
            '/\{ldcms:(\w+)\s+(.*?)\/\}/',
            function($matches) {
                $tagName = $matches[1];
                $attributes = $matches[2];
                
                return $this->processLdcmsTag($tagName, $attributes);
            },
            $content
        );
        
        return $content;
    }
    
    /**
     * å¤„ç†LDCMSæ ‡ç­¾
     */
    private function processLdcmsTag($tagName, $attributes, $innerContent = '')
    {
        $attrs = $this->parseAttributes($attributes);
        
        switch ($tagName) {
            case 'category':
                return $this->processCategoryTag($attrs, $innerContent);
            case 'document':
                return $this->processDocumentTag($attrs, $innerContent);
            case 'ad':
                return $this->processAdTag($attrs, $innerContent);
            case 'navigation':
                return $this->processNavigationTag($attrs, $innerContent);
            case 'breadcrumb':
                return $this->processBreadcrumbTag($attrs);
            default:
                return "<!-- Unknown tag: {$tagName} -->";
        }
    }
    
    /**
     * å¤„ç†åˆ†ç±»æ ‡ç­¾
     */
    private function processCategoryTag($attrs, $innerContent)
    {
        $pid = $attrs['pid'] ?? 0;
        $limit = $attrs['limit'] ?? 10;
        $order = $attrs['order'] ?? 'sort asc';
        
        $php = "<?php\n";
        $php .= "\$categoryList = \\addons\\ldcms\\model\\Category::where('pid', {$pid})\n";
        $php .= "    ->where('status', 1)\n";
        $php .= "    ->where('lang', LanguageHandler::getCurrentLanguage())\n";
        $php .= "    ->limit({$limit})\n";
        $php .= "    ->order('{$order}')\n";
        $php .= "    ->select();\n";
        $php .= "foreach (\$categoryList as \$category) {\n";
        $php .= "    extract(\$category->toArray());\n";
        $php .= "?>\n";
        $php .= $innerContent;
        $php .= "\n<?php } ?>";
        
        return $php;
    }
    
    /**
     * å¤„ç†æ–‡æ¡£æ ‡ç­¾
     */
    private function processDocumentTag($attrs, $innerContent)
    {
        $cid = $attrs['cid'] ?? 0;
        $limit = $attrs['limit'] ?? 10;
        $order = $attrs['order'] ?? 'create_time desc';
        
        $php = "<?php\n";
        $php .= "\$documentList = \\addons\\ldcms\\model\\Document::where('cid', {$cid})\n";
        $php .= "    ->where('status', 1)\n";
        $php .= "    ->where('lang', LanguageHandler::getCurrentLanguage())\n";
        $php .= "    ->limit({$limit})\n";
        $php .= "    ->order('{$order}')\n";
        $php .= "    ->select();\n";
        $php .= "foreach (\$documentList as \$document) {\n";
        $php .= "    extract(\$document->toArray());\n";
        $php .= "?>\n";
        $php .= $innerContent;
        $php .= "\n<?php } ?>";
        
        return $php;
    }
    
    /**
     * è§£æå±æ€§
     */
    private function parseAttributes($attributeString)
    {
        $attributes = [];
        preg_match_all('/(\w+)=["\']([^"\']*)["\']/', $attributeString, $matches, PREG_SET_ORDER);
        
        foreach ($matches as $match) {
            $attributes[$match[1]] = $match[2];
        }
        
        return $attributes;
    }
    
    /**
     * åˆ›å»ºä¸´æ—¶æ–‡ä»¶
     */
    private function createTempFile($content)
    {
        $tempFile = sys_get_temp_dir() . '/ldcms_template_' . uniqid() . '.php';
        file_put_contents($tempFile, $content);
        
        return $tempFile;
    }
    
    /**
     * æ¸²æŸ“åŒºå—
     */
    public function renderBlock($blockName)
    {
        return $this->blocks[$blockName] ?? '';
    }
    
    /**
     * å¤„ç†æ¨¡æ¿ç»§æ‰¿
     */
    private function processExtends($content)
    {
        if (!$this->extends) {
            return $content;
        }
        
        $parentTemplate = new self($this->extends);
        $parentTemplate->assign($this->variables);
        $parentTemplate->blocks = $this->blocks;
        
        return $parentTemplate->render();
    }
}
```

---

## ğŸ¯ æ¨¡æ¿æ ‡ç­¾ç³»ç»Ÿ

### æ ¸å¿ƒæ ‡ç­¾åº“
```php
/**
 * LDCMSæ¨¡æ¿æ ‡ç­¾åº“
 */
class LdcmsTagLib extends \think\template\TagLib
{
    /**
     * æ ‡ç­¾å®šä¹‰
     */
    protected $tags = [
        // åˆ†ç±»æ ‡ç­¾
        'category' => ['attr' => 'pid,limit,order,where', 'close' => 1],
        // æ–‡æ¡£æ ‡ç­¾  
        'document' => ['attr' => 'cid,limit,order,where', 'close' => 1],
        // å¹¿å‘Šæ ‡ç­¾
        'ad' => ['attr' => 'type,limit,order', 'close' => 1],
        // å¯¼èˆªæ ‡ç­¾
        'navigation' => ['attr' => 'type,pid,level', 'close' => 1],
        // é¢åŒ…å±‘æ ‡ç­¾
        'breadcrumb' => ['attr' => 'separator,home', 'close' => 0],
        // åˆ†é¡µæ ‡ç­¾
        'pagination' => ['attr' => 'list,simple', 'close' => 0],
        // æœç´¢æ ‡ç­¾
        'search' => ['attr' => 'type,placeholder', 'close' => 0],
        // è¯­è¨€åˆ‡æ¢æ ‡ç­¾
        'language' => ['attr' => 'type', 'close' => 1],
        // è‡ªå®šä¹‰å­—æ®µæ ‡ç­¾
        'fields' => ['attr' => 'model,id', 'close' => 1],
        // æ ‡ç­¾äº‘æ ‡ç­¾
        'tags' => ['attr' => 'limit,order', 'close' => 1],
        // å‹æƒ…é“¾æ¥æ ‡ç­¾
        'links' => ['attr' => 'type,limit', 'close' => 1],
        // ç»Ÿè®¡æ ‡ç­¾
        'statistics' => ['attr' => 'type', 'close' => 0],
    ];
    
    /**
     * åˆ†ç±»æ ‡ç­¾è§£æ
     */
    public function tagCategory($tag, $content)
    {
        $pid = isset($tag['pid']) ? $tag['pid'] : 0;
        $limit = isset($tag['limit']) ? $tag['limit'] : 10;
        $order = isset($tag['order']) ? $tag['order'] : 'sort asc';
        $where = isset($tag['where']) ? $tag['where'] : '';
        
        $parse = '<?php ';
        $parse .= '$__CATEGORY_LIST__ = \\addons\\ldcms\\model\\Category::where("pid", ' . $pid . ')';
        $parse .= '->where("status", 1)';
        $parse .= '->where("lang", \\addons\\ldcms\\utils\\LanguageHandler::getCurrentLanguage())';
        
        if ($where) {
            $parse .= '->where("' . $where . '")';
        }
        
        $parse .= '->limit(' . $limit . ')';
        $parse .= '->order("' . $order . '")';
        $parse .= '->select(); ';
        $parse .= 'if($__CATEGORY_LIST__): foreach($__CATEGORY_LIST__ as $key=>$category): ';
        $parse .= '$category["url"] = \\addons\\ldcms\\utils\\SEOFriendlyURL::categoryUrl($category->toArray()); ';
        $parse .= '?>';
        $parse .= $content;
        $parse .= '<?php endforeach; endif; ?>';
        
        return $parse;
    }
    
    /**
     * æ–‡æ¡£æ ‡ç­¾è§£æ
     */
    public function tagDocument($tag, $content)
    {
        $cid = isset($tag['cid']) ? $tag['cid'] : 0;
        $limit = isset($tag['limit']) ? $tag['limit'] : 10;
        $order = isset($tag['order']) ? $tag['order'] : 'create_time desc';
        $where = isset($tag['where']) ? $tag['where'] : '';
        
        $parse = '<?php ';
        $parse .= '$__DOCUMENT_LIST__ = \\addons\\ldcms\\model\\Document::where("cid", ' . $cid . ')';
        $parse .= '->where("status", 1)';
        $parse .= '->where("lang", \\addons\\ldcms\\utils\\LanguageHandler::getCurrentLanguage())';
        
        if ($where) {
            $parse .= '->where("' . $where . '")';
        }
        
        $parse .= '->limit(' . $limit . ')';
        $parse .= '->order("' . $order . '")';
        $parse .= '->select(); ';
        $parse .= 'if($__DOCUMENT_LIST__): foreach($__DOCUMENT_LIST__ as $key=>$document): ';
        $parse .= '$document["url"] = \\addons\\ldcms\\utils\\SEOFriendlyURL::documentUrl($document->toArray()); ';
        $parse .= '$document["thumb"] = $document["images"] ? explode(",", $document["images"])[0] : ""; ';
        $parse .= '?>';
        $parse .= $content;
        $parse .= '<?php endforeach; endif; ?>';
        
        return $parse;
    }
    
    /**
     * å¹¿å‘Šæ ‡ç­¾è§£æ
     */
    public function tagAd($tag, $content)
    {
        $type = isset($tag['type']) ? $tag['type'] : '';
        $limit = isset($tag['limit']) ? $tag['limit'] : 5;
        $order = isset($tag['order']) ? $tag['order'] : 'sort asc';
        
        $parse = '<?php ';
        $parse .= '$__AD_LIST__ = \\addons\\ldcms\\model\\Ad::where("type", "' . $type . '")';
        $parse .= '->where("status", 1)';
        $parse .= '->where("lang", \\addons\\ldcms\\utils\\LanguageHandler::getCurrentLanguage())';
        $parse .= '->limit(' . $limit . ')';
        $parse .= '->order("' . $order . '")';
        $parse .= '->select(); ';
        $parse .= 'if($__AD_LIST__): foreach($__AD_LIST__ as $key=>$ad): ';
        $parse .= '?>';
        $parse .= $content;
        $parse .= '<?php endforeach; endif; ?>';
        
        return $parse;
    }
    
    /**
     * å¯¼èˆªæ ‡ç­¾è§£æ
     */
    public function tagNavigation($tag, $content)
    {
        $type = isset($tag['type']) ? $tag['type'] : 'main';
        $pid = isset($tag['pid']) ? $tag['pid'] : 0;
        $level = isset($tag['level']) ? $tag['level'] : 1;
        
        $parse = '<?php ';
        $parse .= '$__NAV_LIST__ = \\addons\\ldcms\\utils\\NavigationHelper::getNavigation("' . $type . '", ' . $pid . ', ' . $level . '); ';
        $parse .= 'if($__NAV_LIST__): foreach($__NAV_LIST__ as $key=>$nav): ';
        $parse .= '?>';
        $parse .= $content;
        $parse .= '<?php endforeach; endif; ?>';
        
        return $parse;
    }
    
    /**
     * é¢åŒ…å±‘æ ‡ç­¾è§£æ
     */
    public function tagBreadcrumb($tag)
    {
        $separator = isset($tag['separator']) ? $tag['separator'] : ' > ';
        $home = isset($tag['home']) ? $tag['home'] : 'é¦–é¡µ';
        
        $parse = '<?php ';
        $parse .= 'echo \\addons\\ldcms\\utils\\BreadcrumbHelper::render("' . $separator . '", "' . $home . '"); ';
        $parse .= '?>';
        
        return $parse;
    }
    
    /**
     * åˆ†é¡µæ ‡ç­¾è§£æ
     */
    public function tagPagination($tag)
    {
        $list = isset($tag['list']) ? $tag['list'] : '$list';
        $simple = isset($tag['simple']) ? $tag['simple'] : 'false';
        
        $parse = '<?php ';
        $parse .= 'if(isset(' . $list . ') && is_object(' . $list . ') && method_exists(' . $list . ', "render")): ';
        $parse .= 'echo ' . $list . '->render(); ';
        $parse .= 'endif; ';
        $parse .= '?>';
        
        return $parse;
    }
    
    /**
     * æœç´¢æ ‡ç­¾è§£æ
     */
    public function tagSearch($tag)
    {
        $type = isset($tag['type']) ? $tag['type'] : 'simple';
        $placeholder = isset($tag['placeholder']) ? $tag['placeholder'] : 'è¯·è¾“å…¥æœç´¢å…³é”®è¯';
        
        $parse = '<?php ';
        $parse .= 'echo \\addons\\ldcms\\utils\\SearchHelper::render("' . $type . '", "' . $placeholder . '"); ';
        $parse .= '?>';
        
        return $parse;
    }
    
    /**
     * è¯­è¨€åˆ‡æ¢æ ‡ç­¾è§£æ
     */
    public function tagLanguage($tag, $content)
    {
        $type = isset($tag['type']) ? $tag['type'] : 'dropdown';
        
        $parse = '<?php ';
        $parse .= '$__LANGUAGE_LIST__ = \\addons\\ldcms\\utils\\MultiLanguageConfig::getEnabledLanguages(); ';
        $parse .= '$__CURRENT_LANG__ = \\addons\\ldcms\\utils\\LanguageHandler::getCurrentLanguage(); ';
        $parse .= 'if($__LANGUAGE_LIST__): foreach($__LANGUAGE_LIST__ as $lang_code=>$lang_info): ';
        $parse .= '$lang_info["active"] = ($lang_code == $__CURRENT_LANG__); ';
        $parse .= '$lang_info["url"] = \\addons\\ldcms\\utils\\LanguageHandler::generateUrl(request()->pathinfo(), [], $lang_code); ';
        $parse .= '?>';
        $parse .= $content;
        $parse .= '<?php endforeach; endif; ?>';
        
        return $parse;
    }
}
```

### æ¨¡æ¿è¾…åŠ©å‡½æ•°
```php
/**
 * æ¨¡æ¿è¾…åŠ©å‡½æ•°
 */
class TemplateHelper
{
    /**
     * è·å–æ¨¡æ¿è®¾ç½®
     */
    public static function getSetting($key, $default = '')
    {
        return TemplateManager::getTemplateSetting($key, null, $default);
    }
    
    /**
     * è·å–æ¨¡æ¿URL
     */
    public static function getTemplateUrl($file = '')
    {
        return TemplateManager::getTemplateUrl(null, $file);
    }
    
    /**
     * è·å–é™æ€èµ„æºURL
     */
    public static function asset($file)
    {
        return self::getTemplateUrl('static/' . $file);
    }
    
    /**
     * è·å–CSSæ–‡ä»¶URL
     */
    public static function css($file)
    {
        return self::asset('css/' . $file);
    }
    
    /**
     * è·å–JSæ–‡ä»¶URL
     */
    public static function js($file)
    {
        return self::asset('js/' . $file);
    }
    
    /**
     * è·å–å›¾ç‰‡URL
     */
    public static function img($file)
    {
        return self::asset('images/' . $file);
    }
    
    /**
     * æ¸²æŸ“CSSé“¾æ¥
     */
    public static function renderCss($files)
    {
        if (!is_array($files)) {
            $files = [$files];
        }
        
        $html = '';
        foreach ($files as $file) {
            $url = self::css($file);
            $html .= '<link rel="stylesheet" href="' . $url . '">' . "\n";
        }
        
        return $html;
    }
    
    /**
     * æ¸²æŸ“JSé“¾æ¥
     */
    public static function renderJs($files)
    {
        if (!is_array($files)) {
            $files = [$files];
        }
        
        $html = '';
        foreach ($files as $file) {
            $url = self::js($file);
            $html .= '<script src="' . $url . '"></script>' . "\n";
        }
        
        return $html;
    }
    
    /**
     * ç”Ÿæˆç¼©ç•¥å›¾
     */
    public static function thumb($image, $width = 300, $height = 200, $type = 'crop')
    {
        if (empty($image)) {
            return self::img('placeholder.jpg');
        }
        
        // å¦‚æœæ˜¯å®Œæ•´URLï¼Œç›´æ¥è¿”å›
        if (strpos($image, 'http') === 0) {
            return $image;
        }
        
        // ç”Ÿæˆç¼©ç•¥å›¾URL
        $thumbUrl = '/addons/ldcms/thumb.php?src=' . urlencode($image);
        $thumbUrl .= '&w=' . $width . '&h=' . $height . '&t=' . $type;
        
        return $thumbUrl;
    }
    
    /**
     * æ ¼å¼åŒ–æ—¥æœŸ
     */
    public static function formatDate($timestamp, $format = null)
    {
        if (!$timestamp) {
            return '';
        }
        
        $format = $format ?: get_current_language_config()['date_format'] ?? 'Y-m-d';
        
        return date($format, is_numeric($timestamp) ? $timestamp : strtotime($timestamp));
    }
    
    /**
     * æˆªå–æ–‡æœ¬
     */
    public static function truncate($text, $length = 100, $suffix = '...')
    {
        if (mb_strlen($text) <= $length) {
            return $text;
        }
        
        return mb_substr($text, 0, $length) . $suffix;
    }
    
    /**
     * é«˜äº®æœç´¢å…³é”®è¯
     */
    public static function highlight($text, $keywords, $class = 'highlight')
    {
        if (empty($keywords)) {
            return $text;
        }
        
        $keywords = is_array($keywords) ? $keywords : [$keywords];
        
        foreach ($keywords as $keyword) {
            $text = preg_replace('/(' . preg_quote($keyword, '/') . ')/i', 
                               '<span class="' . $class . '">$1</span>', $text);
        }
        
        return $text;
    }
    
    /**
     * ç”Ÿæˆé¢åŒ…å±‘å¯¼èˆª
     */
    public static function breadcrumb($items, $separator = ' > ', $class = 'breadcrumb')
    {
        if (empty($items)) {
            return '';
        }
        
        $html = '<nav class="' . $class . '">';
        $html .= '<ol>';
        
        foreach ($items as $index => $item) {
            $html .= '<li>';
            
            if (isset($item['url']) && $index < count($items) - 1) {
                $html .= '<a href="' . $item['url'] . '">' . $item['title'] . '</a>';
            } else {
                $html .= $item['title'];
            }
            
            if ($index < count($items) - 1) {
                $html .= '<span class="separator">' . $separator . '</span>';
            }
            
            $html .= '</li>';
        }
        
        $html .= '</ol>';
        $html .= '</nav>';
        
        return $html;
    }
}
```

---

## ğŸ“± å“åº”å¼æ¨¡æ¿å¼€å‘

### å“åº”å¼æ–­ç‚¹æ ‡å‡†
```css
/* å“åº”å¼æ–­ç‚¹å®šä¹‰ */
:root {
    --breakpoint-xs: 0;
    --breakpoint-sm: 576px;
    --breakpoint-md: 768px;
    --breakpoint-lg: 992px;
    --breakpoint-xl: 1200px;
    --breakpoint-xxl: 1400px;
}

/* åª’ä½“æŸ¥è¯¢æ··åˆå™¨ */
@media (max-width: 575.98px) {
    /* Extra small devices (portrait phones) */
    .hidden-xs { display: none !important; }
    .visible-xs { display: block !important; }
}

@media (min-width: 576px) and (max-width: 767.98px) {
    /* Small devices (landscape phones) */
    .hidden-sm { display: none !important; }
    .visible-sm { display: block !important; }
}

@media (min-width: 768px) and (max-width: 991.98px) {
    /* Medium devices (tablets) */
    .hidden-md { display: none !important; }
    .visible-md { display: block !important; }
}

@media (min-width: 992px) and (max-width: 1199.98px) {
    /* Large devices (desktops) */
    .hidden-lg { display: none !important; }
    .visible-lg { display: block !important; }
}

@media (min-width: 1200px) {
    /* Extra large devices (large desktops) */
    .hidden-xl { display: none !important; }
    .visible-xl { display: block !important; }
}
```

### ç§»åŠ¨ç«¯ä¼˜åŒ–
```html
<!-- ç§»åŠ¨ç«¯ä¼˜åŒ–çš„HTMLç»“æ„ -->
<!DOCTYPE html>
<html lang="{$Think.lang}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>{$seo.title}</title>
    <meta name="keywords" content="{$seo.keywords}">
    <meta name="description" content="{$seo.description}">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="{:css('critical.css')}" as="style">
    <link rel="preload" href="{:js('critical.js')}" as="script">
    
    <!-- Critical CSS inline -->
    <style>
        /* Critical above-the-fold styles */
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .header { background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
    </style>
    
    <!-- Non-critical CSS -->
    <link rel="preload" href="{:css('main.css')}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{:css('main.css')}"></noscript>
</head>
<body>
    <!-- Mobile-first navigation -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <div class="navbar-brand">
                    <a href="{:multilang_url('/')}">{$site.name}</a>
                </div>
                
                <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-menu">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                
                <div class="navbar-collapse collapse" id="navbar-menu">
                    {ldcms:navigation type="main"}
                    <ul class="navbar-nav">
                        <li class="nav-item {eq name='nav.active' value='1'}active{/eq}">
                            <a class="nav-link" href="{$nav.url}">{$nav.title}</a>
                            {if condition="$nav.children"}
                            <ul class="dropdown-menu">
                                {volist name="nav.children" id="child"}
                                <li><a href="{$child.url}">{$child.title}</a></li>
                                {/volist}
                            </ul>
                            {/if}
                        </li>
                    </ul>
                    {/ldcms:navigation}
                </div>
            </nav>
        </div>
    </header>
    
    <main class="main">
        {block name="content"}{/block}
    </main>
    
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 {$site.name}. All rights reserved.</p>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script>
        // Critical JavaScript inline
        (function() {
            // Mobile menu toggle
            document.addEventListener('DOMContentLoaded', function() {
                var toggle = document.querySelector('.navbar-toggle');
                var menu = document.querySelector('.navbar-collapse');
                
                if (toggle && menu) {
                    toggle.addEventListener('click', function() {
                        menu.classList.toggle('show');
                    });
                }
            });
        })();
    </script>
    
    <!-- Non-critical JavaScript -->
    <script async src="{:js('main.js')}"></script>
</body>
</html>
```

---

## ğŸ“‹ æ¨¡æ¿å¼€å‘æ£€æŸ¥æ¸…å•

### åŸºç¡€ç»“æ„æ£€æŸ¥
- [ ] æ¨¡æ¿ç›®å½•ç»“æ„è§„èŒƒ
- [ ] é…ç½®æ–‡ä»¶å®Œæ•´
- [ ] æ¨¡æ¿ä¿¡æ¯æ–‡ä»¶å­˜åœ¨
- [ ] é™æ€èµ„æºç»„ç»‡åˆç†
- [ ] é¢„è§ˆå›¾å’Œæˆªå›¾å‡†å¤‡
- [ ] è®¸å¯è¯æ–‡ä»¶åŒ…å«

### åŠŸèƒ½ç‰¹æ€§æ£€æŸ¥
- [ ] å“åº”å¼è®¾è®¡å®ç°
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] SEOä¼˜åŒ–
- [ ] è‡ªå®šä¹‰æ ‡ç­¾ä½¿ç”¨
- [ ] æ¨¡æ¿ç»§æ‰¿å®ç°
- [ ] åŒºå—ç³»ç»Ÿä½¿ç”¨
- [ ] åŒ…å«æ–‡ä»¶å¤„ç†

### æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥
- [ ] å…³é”®CSSå†…è”
- [ ] éå…³é”®èµ„æºå»¶è¿ŸåŠ è½½
- [ ] å›¾ç‰‡æ‡’åŠ è½½
- [ ] èµ„æºå‹ç¼©
- [ ] ç¼“å­˜ç­–ç•¥
- [ ] CDNæ”¯æŒ
- [ ] ç§»åŠ¨ç«¯ä¼˜åŒ–

### å…¼å®¹æ€§æ£€æŸ¥
- [ ] æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
- [ ] ç§»åŠ¨è®¾å¤‡æµ‹è¯•
- [ ] ä¸åŒåˆ†è¾¨ç‡æµ‹è¯•
- [ ] æ‰“å°æ ·å¼
- [ ] æ— éšœç¢è®¿é—®
- [ ] æœç´¢å¼•æ“å‹å¥½

### å®‰å…¨æ€§æ£€æŸ¥
- [ ] è¾“å‡ºè½¬ä¹‰
- [ ] XSSé˜²æŠ¤
- [ ] CSRFé˜²æŠ¤
- [ ] å®‰å…¨å¤´è®¾ç½®
- [ ] å†…å®¹å®‰å…¨ç­–ç•¥
- [ ] æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

---

**æ³¨æ„**: å¤šæ¨¡æ¿ç³»ç»Ÿçš„è®¾è®¡åº”è¯¥è€ƒè™‘æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ï¼Œå»ºè®®ä½¿ç”¨æ¨¡å—åŒ–çš„æ–¹å¼ç»„ç»‡ä»£ç ï¼Œä¾¿äºåç»­çš„å‡çº§å’Œå®šåˆ¶ã€‚