---
alwaysApply: true
priority: 3
techStack: "FastAdmin CRUD Generator"
---

# FastAdmin CRUDç”Ÿæˆæ ‡å‡†è§„èŒƒ

> **åŠŸèƒ½**: ä¸€é”®ç”ŸæˆCRUDï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰åŠŸèƒ½
> **é€‚ç”¨åœºæ™¯**: å¿«é€Ÿå¼€å‘æ•°æ®ç®¡ç†æ¨¡å—ã€åå°ç®¡ç†åŠŸèƒ½

---

## ğŸš€ CRUDç”Ÿæˆå‘½ä»¤è§„èŒƒ

### åŸºç¡€ç”Ÿæˆå‘½ä»¤
```bash
# åŸºç¡€CRUDç”Ÿæˆ
php think crud -t table_name

# æŒ‡å®šæ§åˆ¶å™¨åç§°
php think crud -t table_name -c ControllerName

# æŒ‡å®šæ¨¡å‹åç§°
php think crud -t table_name -m ModelName

# ç”Ÿæˆåˆ°æŒ‡å®šæ¨¡å—
php think crud -t table_name --module=admin

# å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶
php think crud -t table_name --force=true

# ç”Ÿæˆæ—¶è·³è¿‡æŸäº›å­—æ®µ
php think crud -t table_name --fields=id,password,delete_time

# ç”Ÿæˆå…³è”è¡¨CRUD
php think crud -t table_name --relation=user:user_id:id

# ç”Ÿæˆæ ‘å½¢ç»“æ„CRUD
php think crud -t table_name --tree=true
```

### ç”Ÿæˆèœå•å‘½ä»¤
```bash
# ç”Ÿæˆèœå•å’Œæƒé™è§„åˆ™
php think menu -c ControllerName

# æŒ‡å®šèœå•çˆ¶çº§
php think menu -c ControllerName --parent=system

# æŒ‡å®šèœå•æ ‡é¢˜
php think menu -c ControllerName --title="ç”¨æˆ·ç®¡ç†"

# æŒ‡å®šèœå•å›¾æ ‡
php think menu -c ControllerName --icon="fa fa-user"
```

---

## ğŸ—ƒï¸ æ•°æ®è¡¨è®¾è®¡è§„èŒƒ

### è¡¨ç»“æ„æ ‡å‡†
```sql
-- åŸºç¡€ç”¨æˆ·è¡¨ç¤ºä¾‹
CREATE TABLE `fa_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `username` varchar(32) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å',
  `nickname` varchar(50) NOT NULL DEFAULT '' COMMENT 'æ˜µç§°', 
  `password` varchar(32) NOT NULL DEFAULT '' COMMENT 'å¯†ç ',
  `salt` varchar(30) NOT NULL DEFAULT '' COMMENT 'å¯†ç ç›',
  `email` varchar(100) NOT NULL DEFAULT '' COMMENT 'ç”µå­é‚®ç®±',
  `mobile` varchar(11) NOT NULL DEFAULT '' COMMENT 'æ‰‹æœºå·',
  `avatar` varchar(255) NOT NULL DEFAULT '' COMMENT 'å¤´åƒ',
  `level` tinyint(1) unsigned NOT NULL DEFAULT '1' COMMENT 'ç­‰çº§',
  `gender` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'æ€§åˆ«:0=ä¿å¯†,1=ç”·,2=å¥³',
  `birthday` date DEFAULT NULL COMMENT 'ç”Ÿæ—¥',
  `bio` text COMMENT 'æ ¼è¨€',
  `money` decimal(10,2) unsigned NOT NULL DEFAULT '0.00' COMMENT 'ä½™é¢',
  `score` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'ç§¯åˆ†',
  `successions` int(10) unsigned NOT NULL DEFAULT '1' COMMENT 'è¿ç»­ç™»å½•å¤©æ•°',
  `maxsuccessions` int(10) unsigned NOT NULL DEFAULT '1' COMMENT 'æœ€å¤§è¿ç»­ç™»å½•å¤©æ•°',
  `prevtime` int(10) unsigned DEFAULT NULL COMMENT 'ä¸Šæ¬¡ç™»å½•æ—¶é—´',
  `logintime` int(10) unsigned DEFAULT NULL COMMENT 'ç™»å½•æ—¶é—´',
  `loginip` varchar(50) DEFAULT NULL COMMENT 'ç™»å½•IP',
  `loginfailure` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'å¤±è´¥æ¬¡æ•°',
  `joinip` varchar(50) DEFAULT NULL COMMENT 'åŠ å…¥IP',
  `jointime` int(10) unsigned DEFAULT NULL COMMENT 'åŠ å…¥æ—¶é—´',
  `createtime` int(10) unsigned DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `updatetime` int(10) unsigned DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `token` varchar(59) NOT NULL DEFAULT '' COMMENT 'Token',
  `status` enum('normal','hidden') NOT NULL DEFAULT 'normal' COMMENT 'çŠ¶æ€',
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `email` (`email`),
  UNIQUE KEY `mobile` (`mobile`),
  KEY `status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

### å­—æ®µå‘½åè§„èŒƒ
| å­—æ®µç±»å‹ | å‘½åè§„èŒƒ | ç¤ºä¾‹ | è¯´æ˜ |
|---------|---------|------|------|
| **ä¸»é”®** | `id` | `id` | ç»Ÿä¸€ä½¿ç”¨idä½œä¸ºä¸»é”® |
| **æ—¶é—´å­—æ®µ** | `xxxtime` | `createtime`, `updatetime` | ä½¿ç”¨intç±»å‹å­˜å‚¨æ—¶é—´æˆ³ |
| **çŠ¶æ€å­—æ®µ** | `status` | `status` | ä½¿ç”¨enumç±»å‹ï¼Œå¦‚normal,hidden |
| **æ’åºå­—æ®µ** | `weigh` | `weigh` | ä½¿ç”¨intç±»å‹ï¼Œæ•°å€¼è¶Šå¤§è¶Šé å‰ |
| **çˆ¶çº§å­—æ®µ** | `pid` | `pid` | æ ‘å½¢ç»“æ„çš„çˆ¶çº§ID |
| **å…³è”å­—æ®µ** | `xxx_id` | `user_id`, `category_id` | å¤–é”®å­—æ®µä»¥_idç»“å°¾ |
| **å¸ƒå°”å­—æ®µ** | `is_xxx` | `is_default`, `is_recommend` | å¸ƒå°”å€¼å­—æ®µä»¥is_å¼€å¤´ |
| **æ•°é‡å­—æ®µ** | `xxx_count` | `view_count`, `like_count` | ç»Ÿè®¡æ•°é‡å­—æ®µä»¥_countç»“å°¾ |

### å­—æ®µç±»å‹è§„èŒƒ
```sql
-- å­—ç¬¦ä¸²ç±»å‹
`title` varchar(100) NOT NULL DEFAULT '' COMMENT 'æ ‡é¢˜',
`content` text COMMENT 'å†…å®¹',
`description` varchar(255) NOT NULL DEFAULT '' COMMENT 'æè¿°',

-- æ•°å€¼ç±»å‹  
`price` decimal(10,2) unsigned NOT NULL DEFAULT '0.00' COMMENT 'ä»·æ ¼',
`amount` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'æ•°é‡',
`rate` float(3,2) unsigned NOT NULL DEFAULT '0.00' COMMENT 'è¯„åˆ†',

-- æ—¶é—´ç±»å‹
`createtime` int(10) unsigned DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
`updatetime` int(10) unsigned DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
`deletetime` int(10) unsigned DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´',

-- æšä¸¾ç±»å‹
`status` enum('normal','hidden','locked') NOT NULL DEFAULT 'normal' COMMENT 'çŠ¶æ€',
`type` enum('user','admin','guest') NOT NULL DEFAULT 'user' COMMENT 'ç±»å‹',

-- JSONç±»å‹ï¼ˆMySQL 5.7+ï¼‰
`extra` json DEFAULT NULL COMMENT 'æ‰©å±•ä¿¡æ¯',
`config` json DEFAULT NULL COMMENT 'é…ç½®ä¿¡æ¯',
```

---

## ğŸ¯ æ§åˆ¶å™¨ç”Ÿæˆè§„èŒƒ

### ç”Ÿæˆçš„æ§åˆ¶å™¨ç»“æ„
```php
<?php
namespace app\admin\controller;

use app\common\controller\Backend;

/**
 * ç”¨æˆ·ç®¡ç†
 *
 * @icon fa fa-circle-o
 */
class User extends Backend
{
    /**
     * Useræ¨¡å‹å¯¹è±¡
     * @var \app\admin\model\User
     */
    protected $model = null;
    
    /**
     * å¿«é€Ÿæœç´¢æ—¶çš„å­—æ®µ
     */
    protected $searchFields = 'id,username,nickname,email';
    
    /**
     * æ˜¯å¦å¼€å¯å…³è”æŸ¥è¯¢
     */
    protected $relationSearch = true;
    
    /**
     * è®¾ç½®è¿‡æ»¤æ–¹æ³•
     */
    protected $multiFields = 'status';
    
    public function _initialize()
    {
        parent::_initialize();
        $this->model = new \app\admin\model\User;
        $this->view->assign("statusList", $this->model->getStatusList());
        $this->view->assign("genderList", $this->model->getGenderList());
    }

    /**
     * é»˜è®¤ç”Ÿæˆçš„æ§åˆ¶å™¨æ‰€ç»§æ‰¿çš„çˆ¶ç±»ä¸­æœ‰index/add/edit/del/multiäº”ä¸ªåŸºç¡€æ–¹æ³•
     * å› æ­¤åœ¨å½“å‰æ§åˆ¶å™¨ä¸­å¯ä¸ç”¨ç¼–å†™å¢åˆ æ”¹æŸ¥çš„ä»£ç ,é™¤ééœ€è¦è‡ªå®šä¹‰
     * å¦‚æœéœ€è¦è‡ªå®šä¹‰,å¯ä»¥å°†application/admin/library/traits/Backend.phpä¸­å¯¹åº”çš„æ–¹æ³•å¤åˆ¶åˆ°å½“å‰æ§åˆ¶å™¨,ç„¶åè¿›è¡Œä¿®æ”¹
     */

    /**
     * æŸ¥çœ‹
     */
    public function index()
    {
        //å½“å‰æ˜¯å¦ä¸ºå…³è”æŸ¥è¯¢
        $this->relationSearch = true;
        //è®¾ç½®è¿‡æ»¤æ–¹æ³•
        $this->request->filter(['strip_tags', 'trim']);
        if ($this->request->isAjax()) {
            //å¦‚æœå‘é€çš„æ¥æºæ˜¯Selectpageï¼Œåˆ™è½¬å‘åˆ°Selectpage
            if ($this->request->request('keyField')) {
                return $this->selectpage();
            }
            list($where, $sort, $order, $offset, $limit) = $this->buildparams();

            $list = $this->model
                    ->with(['usergroup'])
                    ->where($where)
                    ->order($sort, $order)
                    ->paginate($limit);

            foreach ($list as $row) {
                $row->visible(['id','username','nickname','email','mobile','avatar','level','gender','birthday','bio','money','score','successions','maxsuccessions','prevtime','logintime','loginip','loginfailure','joinip','jointime','createtime','updatetime','token','status']);
                $row->visible(['usergroup']);
                $row->getRelation('usergroup')->visible(['name']);
            }

            $result = array("total" => $list->total(), "rows" => $list->items());

            return json($result);
        }
        return $this->view->fetch();
    }

    /**
     * æ·»åŠ 
     */
    public function add()
    {
        if ($this->request->isPost()) {
            $params = $this->request->post("row/a");
            if ($params) {
                $params = $this->preExcludeFields($params);

                if ($this->dataLimit && $this->dataLimitFieldAutoFill) {
                    $params[$this->dataLimitField] = $this->auth->id;
                }
                $result = false;
                Db::startTrans();
                try {
                    //æ˜¯å¦é‡‡ç”¨æ¨¡å‹éªŒè¯
                    if ($this->modelValidate) {
                        $name = str_replace("\\model\\", "\\validate\\", get_class($this->model));
                        $validate = is_bool($this->modelValidate) ? ($this->modelSceneValidate ? $name . '.add' : $name) : $this->modelValidate;
                        $this->model->validateFailException(true)->validate($validate);
                    }
                    $result = $this->model->allowField(true)->save($params);
                    Db::commit();
                } catch (ValidateException $e) {
                    Db::rollback();
                    $this->error($e->getMessage());
                } catch (PDOException $e) {
                    Db::rollback();
                    $this->error($e->getMessage());
                } catch (Exception $e) {
                    Db::rollback();
                    $this->error($e->getMessage());
                }
                if ($result !== false) {
                    $this->success();
                } else {
                    $this->error(__('No rows were inserted'));
                }
            }
            $this->error(__('Parameter %s can not be empty', ''));
        }
        return $this->view->fetch();
    }
}
```

### æ§åˆ¶å™¨è‡ªå®šä¹‰æ–¹æ³•
```php
/**
 * æ‰¹é‡æ›´æ–°çŠ¶æ€
 */
public function multi()
{
    if ($this->request->isPost()) {
        $ids = $this->request->post("ids");
        $action = $this->request->post("action");
        if (!$ids) {
            $this->error(__('Parameter %s can not be empty', 'ids'));
        }
        $ids = explode(',', $ids);
        $result = false;
        Db::startTrans();
        try {
            switch ($action) {
                case 'normal':
                    $result = $this->model->where('id', 'in', $ids)->update(['status' => 'normal']);
                    break;
                case 'hidden':
                    $result = $this->model->where('id', 'in', $ids)->update(['status' => 'hidden']);
                    break;
                case 'delete':
                    $result = $this->model->where('id', 'in', $ids)->delete();
                    break;
                default:
                    $this->error(__('Unknown operation'));
            }
            Db::commit();
        } catch (Exception $e) {
            Db::rollback();
            $this->error($e->getMessage());
        }
        if ($result) {
            $this->success();
        } else {
            $this->error(__('No rows were updated'));
        }
    }
    $this->error(__('Invalid parameters'));
}

/**
 * å¯¼å…¥æ•°æ®
 */
public function import()
{
    parent::import();
}

/**
 * å¯¼å‡ºæ•°æ®
 */
public function export()
{
    $list = $this->model->select();
    $header = ['ID', 'ç”¨æˆ·å', 'æ˜µç§°', 'é‚®ç®±', 'æ‰‹æœºå·', 'çŠ¶æ€', 'åˆ›å»ºæ—¶é—´'];
    $data = [];
    foreach ($list as $row) {
        $data[] = [
            $row->id,
            $row->username,
            $row->nickname,
            $row->email,
            $row->mobile,
            $row->status,
            date('Y-m-d H:i:s', $row->createtime)
        ];
    }
    
    $filename = 'user_' . date('YmdHis') . '.xlsx';
    \PhpOffice\PhpSpreadsheet\Helper\Html::toRichTextObject($data);
    return $this->exportExcel($header, $data, $filename);
}
```

---

## ğŸ—ƒï¸ æ¨¡å‹ç”Ÿæˆè§„èŒƒ

### ç”Ÿæˆçš„æ¨¡å‹ç»“æ„
```php
<?php
namespace app\admin\model;

use think\Model;
use traits\model\SoftDelete;

class User extends Model
{
    use SoftDelete;

    // è¡¨å
    protected $name = 'user';
    
    // è‡ªåŠ¨å†™å…¥æ—¶é—´æˆ³å­—æ®µ
    protected $autoWriteTimestamp = 'int';

    // å®šä¹‰æ—¶é—´æˆ³å­—æ®µå
    protected $createTime = 'createtime';
    protected $updateTime = 'updatetime';
    protected $deleteTime = 'deletetime';

    // è¿½åŠ å±æ€§
    protected $append = [
        'status_text',
        'gender_text'
    ];
    

    public function getStatusList()
    {
        return ['normal' => __('Normal'), 'hidden' => __('Hidden')];
    }

    public function getGenderList()
    {
        return ['0' => __('Secrecy'), '1' => __('Male'), '2' => __('Female')];
    }

    public function getStatusTextAttr($value, $data)
    {
        $value = $value ? $value : (isset($data['status']) ? $data['status'] : '');
        $list = $this->getStatusList();
        return isset($list[$value]) ? $list[$value] : '';
    }

    public function getGenderTextAttr($value, $data)
    {
        $value = $value ? $value : (isset($data['gender']) ? $data['gender'] : '');
        $list = $this->getGenderList();
        return isset($list[$value]) ? $list[$value] : '';
    }

    public function usergroup()
    {
        return $this->belongsTo('UserGroup', 'group_id', 'id', [], 'LEFT')->setEagerlyType(0);
    }
}
```

### æ¨¡å‹å…³è”å®šä¹‰
```php
// ä¸€å¯¹ä¸€å…³è”
public function profile()
{
    return $this->hasOne('UserProfile', 'user_id', 'id');
}

// ä¸€å¯¹å¤šå…³è”
public function orders()
{
    return $this->hasMany('Order', 'user_id', 'id');
}

// å¤šå¯¹å¤šå…³è”
public function roles()
{
    return $this->belongsToMany('Role', 'user_role', 'role_id', 'user_id');
}

// å…³è”é¢„è½½å…¥
public function posts()
{
    return $this->hasMany('Post', 'user_id', 'id')->with(['category']);
}

// å¤šæ€å…³è”
public function comments()
{
    return $this->morphMany('Comment', 'commentable');
}
```

---

## ğŸ¨ è§†å›¾ç”Ÿæˆè§„èŒƒ

### åˆ—è¡¨é¡µé¢æ¨¡æ¿
```html
{extend name="layout/default" /}
{block name="content"}
<div class="panel panel-default panel-intro">
    <div class="panel-heading">
        {:build_heading()}
    </div>
    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="one">
                <div class="widget-body no-padding">
                    <div id="toolbar" class="toolbar">
                        <a href="javascript:;" class="btn btn-primary btn-refresh" title="{:__('Refresh')}" ><i class="fa fa-refresh"></i> </a>
                        <a href="javascript:;" class="btn btn-success btn-add {:$auth->check('user/add')?'':'hide'}" title="{:__('Add')}" ><i class="fa fa-plus"></i> {:__('Add')}</a>
                        <a href="javascript:;" class="btn btn-success btn-edit btn-disabled disabled {:$auth->check('user/edit')?'':'hide'}" title="{:__('Edit')}" ><i class="fa fa-pencil"></i> {:__('Edit')}</a>
                        <a href="javascript:;" class="btn btn-danger btn-del btn-disabled disabled {:$auth->check('user/del')?'':'hide'}" title="{:__('Delete')}" ><i class="fa fa-trash"></i> {:__('Delete')}</a>
                        <a href="javascript:;" class="btn btn-danger btn-import {:$auth->check('user/import')?'':'hide'}" title="{:__('Import')}" id="btn-import-file" data-url="ajax/upload" data-mimetype="csv,xls,xlsx" data-multiple="false"><i class="fa fa-upload"></i> {:__('Import')}</a>

                        <div class="dropdown btn-group {:$auth->check('user/multi')?'':'hide'}">
                            <a class="btn btn-primary btn-more dropdown-toggle btn-disabled disabled" data-toggle="dropdown"><i class="fa fa-cog"></i> {:__('More')}</a>
                            <ul class="dropdown-menu text-left" role="menu">
                                <li><a class="btn btn-link btn-multi btn-disabled disabled" href="javascript:;" data-params="status=normal"><i class="fa fa-eye"></i> {:__('Set to normal')}</a></li>
                                <li><a class="btn btn-link btn-multi btn-disabled disabled" href="javascript:;" data-params="status=hidden"><i class="fa fa-eye-slash"></i> {:__('Set to hidden')}</a></li>
                            </ul>
                        </div>
                    </div>
                    <table id="table" class="table table-striped table-bordered table-hover table-nowrap" data-operate-edit="{:$auth->check('user/edit')}" data-operate-del="{:$auth->check('user/del')}" width="100%">
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>
{/block}
{block name="js"}
<script src="{:cdnurl('assets/js/backend/user.js', true)}"></script>
{/block}
```

### æ·»åŠ /ç¼–è¾‘é¡µé¢æ¨¡æ¿
```html
<form id="add-form" class="form-horizontal" role="form" data-toggle="validator" method="POST" action="">
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Username')}:</label>
        <div class="col-xs-12 col-sm-8">
            <input id="c-username" data-rule="required;username" class="form-control" name="row[username]" type="text" value="">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Nickname')}:</label>
        <div class="col-xs-12 col-sm-8">
            <input id="c-nickname" data-rule="required" class="form-control" name="row[nickname]" type="text" value="">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Password')}:</label>
        <div class="col-xs-12 col-sm-8">
            <input id="c-password" data-rule="required;password" class="form-control" name="row[password]" type="password" value="">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Email')}:</label>
        <div class="col-xs-12 col-sm-8">
            <input id="c-email" data-rule="required;email" class="form-control" name="row[email]" type="email" value="">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Mobile')}:</label>
        <div class="col-xs-12 col-sm-8">
            <input id="c-mobile" data-rule="required;mobile" class="form-control" name="row[mobile]" type="text" value="">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Avatar')}:</label>
        <div class="col-xs-12 col-sm-8">
            <div class="input-group">
                <input id="c-avatar" class="form-control" size="50" name="row[avatar]" type="text" value="">
                <div class="input-group-addon no-border no-padding">
                    <span><button type="button" id="plupload-avatar" class="btn btn-danger plupload" data-input-id="c-avatar" data-mimetype="image/gif,image/jpeg,image/png,image/jpg,image/bmp" data-multiple="false" data-preview-id="p-avatar"><i class="fa fa-upload"></i> {:__('Upload')}</button></span>
                    <span><button type="button" id="fachoose-avatar" class="btn btn-primary fachoose" data-input-id="c-avatar" data-mimetype="image/*" data-multiple="false"><i class="fa fa-list"></i> {:__('Choose')}</button></span>
                </div>
                <span class="msg-box n-right" for="c-avatar"></span>
            </div>
            <ul class="row list-inline plupload-preview" id="p-avatar"></ul>
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Status')}:</label>
        <div class="col-xs-12 col-sm-8">
            <div class="radio">
            {foreach name="statusList" item="vo" key="key"}
                <label><input name="row[status]" type="radio" value="{$key}" {in name="key" value="normal"}checked{/in} /> {$vo}</label>
            {/foreach}
            </div>
        </div>
    </div>
    <div class="form-group layer-footer">
        <label class="control-label col-xs-12 col-sm-2"></label>
        <div class="col-xs-12 col-sm-8">
            <button type="submit" class="btn btn-success btn-embossed disabled">{:__('OK')}</button>
            <button type="reset" class="btn btn-default btn-embossed">{:__('Reset')}</button>
        </div>
    </div>
</form>
```

---

## ğŸ¯ JavaScriptç”Ÿæˆè§„èŒƒ

### åˆ—è¡¨é¡µé¢JS
```javascript
define(['jquery', 'bootstrap', 'backend', 'table', 'form'], function ($, undefined, Backend, Table, Form) {

    var Controller = {
        index: function () {
            // åˆå§‹åŒ–è¡¨æ ¼å‚æ•°é…ç½®
            Table.api.init({
                extend: {
                    index_url: 'user/index' + location.search,
                    add_url: 'user/add',
                    edit_url: 'user/edit',
                    del_url: 'user/del',
                    multi_url: 'user/multi',
                    import_url: 'user/import',
                    table: 'user',
                }
            });

            var table = $("#table");

            // åˆå§‹åŒ–è¡¨æ ¼
            table.bootstrapTable({
                url: $.fn.bootstrapTable.defaults.extend.index_url,
                pk: 'id',
                sortName: 'id',
                fixedColumns: true,
                fixedRightNumber: 1,
                columns: [
                    [
                        {checkbox: true},
                        {field: 'id', title: __('Id')},
                        {field: 'username', title: __('Username'), operate: 'LIKE'},
                        {field: 'nickname', title: __('Nickname'), operate: 'LIKE'},
                        {field: 'email', title: __('Email'), operate: 'LIKE'},
                        {field: 'mobile', title: __('Mobile'), operate: 'LIKE'},
                        {field: 'avatar', title: __('Avatar'), events: Table.api.events.image, formatter: Table.api.formatter.image},
                        {field: 'level', title: __('Level')},
                        {field: 'gender', title: __('Gender'), searchList: {"0":__('Secrecy'),"1":__('Male'),"2":__('Female')}, formatter: Table.api.formatter.normal},
                        {field: 'birthday', title: __('Birthday'), operate:'RANGE', addclass:'datetimerange', autocomplete:false},
                        {field: 'bio', title: __('Bio'), operate: 'LIKE'},
                        {field: 'money', title: __('Money'), operate:'BETWEEN'},
                        {field: 'score', title: __('Score')},
                        {field: 'successions', title: __('Successions')},
                        {field: 'maxsuccessions', title: __('Maxsuccessions')},
                        {field: 'prevtime', title: __('Prevtime'), operate:'RANGE', addclass:'datetimerange', autocomplete:false, formatter: Table.api.formatter.datetime},
                        {field: 'logintime', title: __('Logintime'), operate:'RANGE', addclass:'datetimerange', autocomplete:false, formatter: Table.api.formatter.datetime},
                        {field: 'loginip', title: __('Loginip'), operate: 'LIKE'},
                        {field: 'loginfailure', title: __('Loginfailure')},
                        {field: 'joinip', title: __('Joinip'), operate: 'LIKE'},
                        {field: 'jointime', title: __('Jointime'), operate:'RANGE', addclass:'datetimerange', autocomplete:false, formatter: Table.api.formatter.datetime},
                        {field: 'createtime', title: __('Createtime'), operate:'RANGE', addclass:'datetimerange', autocomplete:false, formatter: Table.api.formatter.datetime},
                        {field: 'updatetime', title: __('Updatetime'), operate:'RANGE', addclass:'datetimerange', autocomplete:false, formatter: Table.api.formatter.datetime},
                        {field: 'token', title: __('Token'), operate: 'LIKE'},
                        {field: 'status', title: __('Status'), searchList: {"normal":__('Normal'),"hidden":__('Hidden')}, formatter: Table.api.formatter.status},
                        {field: 'operate', title: __('Operate'), table: table, events: Table.api.events.operate, formatter: Table.api.formatter.operate}
                    ]
                ]
            });

            // ä¸ºè¡¨æ ¼ç»‘å®šäº‹ä»¶
            Table.api.bindevent(table);
        },
        add: function () {
            Controller.api.bindevent();
        },
        edit: function () {
            Controller.api.bindevent();
        },
        api: {
            bindevent: function () {
                Form.api.bindevent($("form[role=form]"));
            }
        }
    };
    return Controller;
});
```

### è¡¨æ ¼å­—æ®µé…ç½®è§„èŒƒ
```javascript
// åŸºç¡€å­—æ®µé…ç½®
{field: 'id', title: __('Id'), sortable: true}

// æ–‡æœ¬æœç´¢å­—æ®µ
{field: 'title', title: __('Title'), operate: 'LIKE', placeholder: __('Fuzzy query')}

// ç²¾ç¡®æœç´¢å­—æ®µ
{field: 'status', title: __('Status'), searchList: {"normal":__('Normal'),"hidden":__('Hidden')}, formatter: Table.api.formatter.status}

// æ—¶é—´èŒƒå›´æœç´¢
{field: 'createtime', title: __('Createtime'), operate:'RANGE', addclass:'datetimerange', autocomplete:false, formatter: Table.api.formatter.datetime}

// æ•°å€¼èŒƒå›´æœç´¢
{field: 'price', title: __('Price'), operate:'BETWEEN', formatter: Table.api.formatter.money}

// å›¾ç‰‡å­—æ®µ
{field: 'avatar', title: __('Avatar'), events: Table.api.events.image, formatter: Table.api.formatter.image}

// å¼€å…³å­—æ®µ
{field: 'switch', title: __('Switch'), table: table, events: Table.api.events.toggle, formatter: Table.api.formatter.toggle}

// è‡ªå®šä¹‰æ ¼å¼åŒ–
{field: 'content', title: __('Content'), formatter: function(value, row, index) {
    return value ? value.substr(0, 50) + '...' : '';
}}

// æ“ä½œåˆ—
{field: 'operate', title: __('Operate'), table: table, events: Table.api.events.operate, formatter: Table.api.formatter.operate, buttons: [
    {name: 'detail', title: __('Detail'), classname: 'btn btn-xs btn-primary btn-detail'},
    {name: 'custom', title: __('Custom'), classname: 'btn btn-xs btn-success btn-custom'}
]}
```

---

## ğŸ“ è¯­è¨€åŒ…ç”Ÿæˆè§„èŒƒ

### ä¸­æ–‡è¯­è¨€åŒ…
```php
<?php
// application/admin/lang/zh-cn/user.php
return [
    'Id'                => 'ID',
    'Username'          => 'ç”¨æˆ·å',
    'Nickname'          => 'æ˜µç§°',
    'Password'          => 'å¯†ç ',
    'Email'             => 'é‚®ç®±',
    'Mobile'            => 'æ‰‹æœºå·',
    'Avatar'            => 'å¤´åƒ',
    'Level'             => 'ç­‰çº§',
    'Gender'            => 'æ€§åˆ«',
    'Birthday'          => 'ç”Ÿæ—¥',
    'Bio'               => 'ä¸ªäººç®€ä»‹',
    'Money'             => 'ä½™é¢',
    'Score'             => 'ç§¯åˆ†',
    'Successions'       => 'è¿ç»­ç™»å½•å¤©æ•°',
    'Maxsuccessions'    => 'æœ€å¤§è¿ç»­ç™»å½•å¤©æ•°',
    'Prevtime'          => 'ä¸Šæ¬¡ç™»å½•æ—¶é—´',
    'Logintime'         => 'ç™»å½•æ—¶é—´',
    'Loginip'           => 'ç™»å½•IP',
    'Loginfailure'      => 'ç™»å½•å¤±è´¥æ¬¡æ•°',
    'Joinip'            => 'æ³¨å†ŒIP',
    'Jointime'          => 'æ³¨å†Œæ—¶é—´',
    'Createtime'        => 'åˆ›å»ºæ—¶é—´',
    'Updatetime'        => 'æ›´æ–°æ—¶é—´',
    'Token'             => 'Token',
    'Status'            => 'çŠ¶æ€',
    'Normal'            => 'æ­£å¸¸',
    'Hidden'            => 'éšè—',
    'Locked'            => 'é”å®š',
    'Male'              => 'ç”·',
    'Female'            => 'å¥³',
    'Secrecy'           => 'ä¿å¯†',
    'Set to normal'     => 'è®¾ä¸ºæ­£å¸¸',
    'Set to hidden'     => 'è®¾ä¸ºéšè—',
    'Set to locked'     => 'è®¾ä¸ºé”å®š',
];
```

---

## ğŸ”§ è‡ªå®šä¹‰é…ç½®è§„èŒƒ

### å­—æ®µç±»å‹æ˜ å°„é…ç½®
```php
// application/admin/command/Crud/stubs/config.stub
return [
    // å­—æ®µç±»å‹æ˜ å°„
    'fieldtype' => [
        'varchar'    => 'string',
        'char'       => 'string', 
        'text'       => 'text',
        'mediumtext' => 'textarea',
        'longtext'   => 'textarea',
        'int'        => 'number',
        'tinyint'    => 'number',
        'bigint'     => 'number',
        'float'      => 'number',
        'double'     => 'number',
        'decimal'    => 'number',
        'date'       => 'date',
        'time'       => 'time',
        'datetime'   => 'datetime',
        'timestamp'  => 'datetime',
        'enum'       => 'select',
        'set'        => 'checkbox',
        'json'       => 'textarea',
    ],
    
    // è¡¨å•éªŒè¯è§„åˆ™æ˜ å°„
    'validation' => [
        'varchar'    => 'require|length:1,255',
        'char'       => 'require|length:1,255',
        'text'       => 'require',
        'int'        => 'require|integer',
        'tinyint'    => 'require|integer|between:0,255',
        'decimal'    => 'require|float',
        'email'      => 'require|email',
        'mobile'     => 'require|mobile',
        'url'        => 'require|url',
        'date'       => 'require|date',
        'datetime'   => 'require|dateFormat:Y-m-d H:i:s',
    ],
    
    // æœç´¢ç±»å‹æ˜ å°„
    'searchtype' => [
        'varchar'    => 'LIKE',
        'char'       => 'LIKE', 
        'text'       => 'LIKE',
        'int'        => '=',
        'tinyint'    => '=',
        'decimal'    => 'BETWEEN',
        'date'       => 'RANGE',
        'datetime'   => 'RANGE',
        'timestamp'  => 'RANGE',
        'enum'       => '=',
    ],
];
```

### CRUDç”Ÿæˆé…ç½®æ–‡ä»¶
```php
// config/crud.php
return [
    // ç”Ÿæˆæ–‡ä»¶çš„æ¨¡æ¿è·¯å¾„
    'template_path' => 'application/admin/command/Crud/stubs/',
    
    // ç”Ÿæˆçš„æ§åˆ¶å™¨å‘½åç©ºé—´
    'controller_namespace' => 'app\\admin\\controller',
    
    // ç”Ÿæˆçš„æ¨¡å‹å‘½åç©ºé—´  
    'model_namespace' => 'app\\admin\\model',
    
    // ç”Ÿæˆçš„éªŒè¯å™¨å‘½åç©ºé—´
    'validate_namespace' => 'app\\admin\\validate',
    
    // ç”Ÿæˆçš„è§†å›¾è·¯å¾„
    'view_path' => 'application/admin/view/',
    
    // ç”Ÿæˆçš„JSè·¯å¾„
    'js_path' => 'public/assets/js/backend/',
    
    // ç”Ÿæˆçš„è¯­è¨€åŒ…è·¯å¾„
    'lang_path' => 'application/admin/lang/zh-cn/',
    
    // æ’é™¤çš„å­—æ®µï¼ˆä¸ç”Ÿæˆåˆ°è¡¨å•ä¸­ï¼‰
    'exclude_fields' => [
        'id', 'createtime', 'updatetime', 'deletetime'
    ],
    
    // åªè¯»å­—æ®µï¼ˆåªæ˜¾ç¤ºä¸å¯ç¼–è¾‘ï¼‰
    'readonly_fields' => [
        'createtime', 'updatetime'
    ],
    
    // éšè—å­—æ®µï¼ˆä¸åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºï¼‰
    'hidden_fields' => [
        'password', 'salt', 'token', 'deletetime'
    ],
    
    // å›¾ç‰‡å­—æ®µï¼ˆè‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼‰
    'image_fields' => [
        'avatar', 'image', 'pic', 'photo', 'thumb'
    ],
    
    // æ–‡ä»¶å­—æ®µï¼ˆè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶ä¸Šä¼ ç»„ä»¶ï¼‰
    'file_fields' => [
        'file', 'attachment', 'document'
    ],
    
    // å¯Œæ–‡æœ¬å­—æ®µï¼ˆè‡ªåŠ¨ç”Ÿæˆç¼–è¾‘å™¨ï¼‰
    'editor_fields' => [
        'content', 'description', 'detail', 'intro'
    ],
    
    // æ—¥æœŸæ—¶é—´å­—æ®µ
    'datetime_fields' => [
        'createtime', 'updatetime', 'logintime', 'jointime'
    ],
];
```

---

## ğŸ¯ é«˜çº§åŠŸèƒ½ç”Ÿæˆè§„èŒƒ

### æ ‘å½¢ç»“æ„CRUD
```bash
# ç”Ÿæˆæ ‘å½¢ç»“æ„CRUD
php think crud -t category --tree=true
```

ç”Ÿæˆçš„æ§åˆ¶å™¨ä¼šåŒ…å«æ ‘å½¢ç»“æ„ç›¸å…³æ–¹æ³•ï¼š
```php
/**
 * æŸ¥çœ‹
 */
public function index()
{
    if ($this->request->isAjax()) {
        $list = $this->model->order('weigh desc,id desc')->select();
        $tree = Tree::instance();
        $tree->init(collection($list)->toArray(), 'pid');
        $list = $tree->getTreeList($tree->getTreeArray(0), 'name');
        
        $result = array("total" => count($list), "rows" => $list);
        return json($result);
    }
    return $this->view->fetch();
}
```

### å…³è”è¡¨CRUD
```bash
# ç”Ÿæˆå¸¦å…³è”çš„CRUD
php think crud -t user --relation=usergroup:group_id:id
```

ç”Ÿæˆçš„æ§åˆ¶å™¨ä¼šåŒ…å«å…³è”æŸ¥è¯¢ï¼š
```php
public function index()
{
    $this->relationSearch = true;
    
    if ($this->request->isAjax()) {
        list($where, $sort, $order, $offset, $limit) = $this->buildparams();
        
        $list = $this->model
                ->with(['usergroup'])
                ->where($where)
                ->order($sort, $order)
                ->paginate($limit);
                
        foreach ($list as $row) {
            $row->visible(['id','username','nickname','email','status']);
            $row->visible(['usergroup']);
            $row->getRelation('usergroup')->visible(['name']);
        }
        
        $result = array("total" => $list->total(), "rows" => $list->items());
        return json($result);
    }
    return $this->view->fetch();
}
```

### å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
```php
/**
 * å¯¼å…¥
 */
public function import()
{
    $file = $this->request->request('file');
    if (!$file) {
        $this->error(__('Parameter %s can not be empty', 'file'));
    }
    $filePath = ROOT_PATH . DS . 'public' . DS . $file;
    if (!is_file($filePath)) {
        $this->error(__('No results were found'));
    }
    
    $ext = pathinfo($filePath, PATHINFO_EXTENSION);
    if (!in_array($ext, ['csv', 'xls', 'xlsx'])) {
        $this->error(__('Unknown data format'));
    }
    
    // å®ä¾‹åŒ–reader
    $reader = \PhpOffice\PhpSpreadsheet\IOFactory::createReader(ucfirst($ext));
    if (!$reader->canRead($filePath)) {
        $this->error(__('Unknown data format'));
    }
    
    // è½½å…¥æ–‡ä»¶
    $insert = [];
    try {
        $spreadsheet = $reader->load($filePath);
        $worksheet = $spreadsheet->getActiveSheet();
        $highestRow = $worksheet->getHighestRow();
        
        for ($row = 2; $row <= $highestRow; $row++) {
            $data = [
                'username'   => $worksheet->getCell('A' . $row)->getValue(),
                'nickname'   => $worksheet->getCell('B' . $row)->getValue(),
                'email'      => $worksheet->getCell('C' . $row)->getValue(),
                'mobile'     => $worksheet->getCell('D' . $row)->getValue(),
                'status'     => $worksheet->getCell('E' . $row)->getValue() ?: 'normal',
                'createtime' => time(),
                'updatetime' => time(),
            ];
            
            if ($data['username']) {
                $insert[] = $data;
            }
        }
    } catch (Exception $e) {
        $this->error($e->getMessage());
    }
    
    if (!$insert) {
        $this->error(__('No rows were inserted'));
    }
    
    try {
        $this->model->saveAll($insert);
    } catch (Exception $e) {
        $this->error($e->getMessage());
    }
    
    $this->success(__('Import successful'));
}
```

---

## ğŸ“‹ è´¨é‡æ£€æŸ¥æ ‡å‡†

### ç”Ÿæˆä»£ç æ£€æŸ¥æ¸…å•
- [ ] æ§åˆ¶å™¨ç»§æ‰¿æ­£ç¡®çš„åŸºç±»
- [ ] æ¨¡å‹å®šä¹‰äº†æ­£ç¡®çš„è¡¨åå’Œå­—æ®µ
- [ ] è§†å›¾æ¨¡æ¿ç»“æ„å®Œæ•´
- [ ] JavaScriptæ¨¡å—å®šä¹‰æ­£ç¡®
- [ ] è¯­è¨€åŒ…ç¿»è¯‘å®Œæ•´
- [ ] å­—æ®µéªŒè¯è§„åˆ™åˆç†
- [ ] æœç´¢åŠŸèƒ½é…ç½®æ­£ç¡®
- [ ] å…³è”æŸ¥è¯¢å®šä¹‰å‡†ç¡®
- [ ] æƒé™æ§åˆ¶è®¾ç½®åˆ°ä½
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„

### åŠŸèƒ½æµ‹è¯•è¦ç‚¹
- [ ] åˆ—è¡¨é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ·»åŠ åŠŸèƒ½æ­£ç¡®æ‰§è¡Œ
- [ ] ç¼–è¾‘åŠŸèƒ½æ­£ç¡®æ‰§è¡Œ
- [ ] åˆ é™¤åŠŸèƒ½æ­£ç¡®æ‰§è¡Œ
- [ ] æ‰¹é‡æ“ä½œåŠŸèƒ½æ­£å¸¸
- [ ] å¯¼å…¥å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] æƒé™æ§åˆ¶ç”Ÿæ•ˆ
- [ ] è¡¨å•éªŒè¯æ­£ç¡®
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸

### æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥
- [ ] æ•°æ®åº“æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•
- [ ] é¿å…N+1æŸ¥è¯¢é—®é¢˜
- [ ] åˆ†é¡µæŸ¥è¯¢é™åˆ¶æ•°é‡
- [ ] å›¾ç‰‡æ‡’åŠ è½½å®ç°
- [ ] é™æ€èµ„æºå‹ç¼©
- [ ] ç¼“å­˜ç­–ç•¥è®¾ç½®
- [ ] å‰ç«¯èµ„æºä¼˜åŒ–
- [ ] æ•°æ®åº“è¿æ¥ä¼˜åŒ–

---

**æ³¨æ„**: ä½¿ç”¨CRUDç”Ÿæˆå™¨å¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆç‡ï¼Œä½†ç”Ÿæˆååº”æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚ç”Ÿæˆçš„ä»£ç åº”ä½œä¸ºå¼€å‘çš„èµ·ç‚¹è€Œéç»ˆç‚¹ã€‚