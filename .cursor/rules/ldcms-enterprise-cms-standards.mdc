---
# ===========================================
# ğŸ¤– AIè‡ªåŠ¨è°ƒåº¦é…ç½® (å¿…éœ€)
# ===========================================
ruleName: "ldcms-enterprise-cms-standards"
description: "FastAdmin LDCMSä¼ä¸šç½‘ç«™ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒå¼€å‘è§„èŒƒï¼ŒåŒ…å«å¤šè¯­è¨€ã€å¤šæ¨¡æ¿ã€è‡ªå®šä¹‰æ¨¡å‹æ”¯æŒ"
version: "1.4.3"
lastUpdated: "2024-12-19"

alwaysApply: false
priority: 10

# ===========================================
# ğŸ” æ™ºèƒ½æ£€æµ‹é…ç½® (æ ¸å¿ƒ)
# ===========================================
detection:
  keywords:
    primary: ["LDCMS", "ldcms", "ä¼ä¸šç½‘ç«™ç®¡ç†ç³»ç»Ÿ"]
    secondary: ["å¤šè¯­è¨€", "å¤šæ¨¡æ¿", "Document", "Category", "Langs"]
    technical: ["addons/ldcms", "fa_ldcms_", "LanguageHandler", "TemplateManager"]
  
  paths:
    exact: ["addons/ldcms/"]
    pattern: ["**/ldcms/**", "**/LDCMS/**"]
  
  contexts:
    development_phase: ["å¼€å‘é˜¶æ®µ", "åŠŸèƒ½æ‰©å±•", "æ¨¡å—å¼€å‘"]
    project_type: ["CMSå¼€å‘", "ä¼ä¸šç½‘ç«™å¼€å‘", "æ’ä»¶å¼€å‘"]
    user_intent: ["åŠŸèƒ½å®ç°", "æ¨¡å—å¼€å‘", "å†…å®¹ç®¡ç†", "ç³»ç»Ÿé›†æˆ"]

# ===========================================
# âš¡ è§¦å‘æ¡ä»¶é…ç½® (ç²¾ç¡®)
# ===========================================
triggers:
  explicit_mentions:
    exact_match: ["LDCMS", "ä¼ä¸šç½‘ç«™ç®¡ç†ç³»ç»Ÿ", "å†…å®¹ç®¡ç†ç³»ç»Ÿ"]
    fuzzy_match: ["ä¼ä¸šç½‘ç«™", "å†…å®¹ç®¡ç†", "CMSç³»ç»Ÿ", "ç½‘ç«™åå°"]
  
  file_operations:
    reading: ["addons/ldcms/ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶"]
    editing: ["LDCMSç›¸å…³çš„æ§åˆ¶å™¨ã€æ¨¡å‹ã€è§†å›¾æ–‡ä»¶"]
    creating: ["æ–°çš„LDCMSåŠŸèƒ½æ¨¡å—", "LDCMSæ’ä»¶æ‰©å±•"]
  
  code_patterns:
    namespaces: ["addons\\ldcms"]
    functions: ["getLdcmsConfig", "renderLdcmsTemplate", "getDocumentList"]
    classes: ["Document", "Category", "Langs", "Ad"]
    comments: ["LDCMS", "ä¼ä¸šç½‘ç«™", "å†…å®¹ç®¡ç†"]
  
  intent_analysis:
    primary_intent: ["cms_development", "plugin_development", "content_management"]
    secondary_intent: ["multilanguage_setup", "template_customization", "seo_optimization"]
    complexity_level: ["medium", "complex"]

# ===========================================
# ğŸ”— å…³è”è§„åˆ™é…ç½®
# ===========================================
relationships:
  required_with: ["fastadmin-v5-standards.mdc"]
  recommended_with: ["fastadmin-multilanguage-standards.mdc", "fastadmin-multitemplate-standards.mdc"]
  depends_on: ["common-rules.mdc"]

# ===========================================
# ğŸ“Š ä½¿ç”¨åœºæ™¯æè¿° (å¸®åŠ©AIç†è§£)
# ===========================================
use_cases:
  primary:
    - scenario: "ç”¨æˆ·è¦ä¸ºLDCMSå¼€å‘æ–°åŠŸèƒ½æ¨¡å—"
      trigger_example: "å¸®æˆ‘ä¸ºLDCMSæ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡æ¡£ç®¡ç†æ¨¡å—"
      expected_behavior: "AIåº”è¯¥åŠ è½½LDCMSè§„èŒƒï¼Œæä¾›ç¬¦åˆLDCMSæ¶æ„çš„å¼€å‘æŒ‡å¯¼"
    - scenario: "ç”¨æˆ·éœ€è¦æ‰©å±•LDCMSç°æœ‰åŠŸèƒ½"
      trigger_example: "å¦‚ä½•ç»™LDCMSçš„æ–‡æ¡£æ¨¡å—æ·»åŠ è¯„è®ºåŠŸèƒ½ï¼Ÿ"
      expected_behavior: "AIåº”è¯¥åŸºäºLDCMSç°æœ‰æ¶æ„æä¾›æ‰©å±•æ–¹æ¡ˆ"
  
  secondary:
    - scenario: "ç”¨æˆ·è¯¢é—®LDCMSé…ç½®é—®é¢˜"
      trigger_example: "LDCMSçš„å¤šè¯­è¨€åŠŸèƒ½æ€ä¹ˆé…ç½®ï¼Ÿ"
      expected_behavior: "AIåº”è¯¥åŸºäºLDCMSè§„èŒƒæä¾›å‡†ç¡®çš„é…ç½®æŒ‡å¯¼"
    - scenario: "ç”¨æˆ·é‡åˆ°LDCMSç›¸å…³é”™è¯¯"
      trigger_example: "LDCMSæ¨¡æ¿æ¸²æŸ“å‡ºé”™äº†"
      expected_behavior: "AIåº”è¯¥æ ¹æ®LDCMSè§„èŒƒæä¾›æ’é”™å»ºè®®"

# ===========================================
# ğŸ¯ AIæŒ‡ä»¤é…ç½® (æ˜ç¡®æŒ‡å¯¼)
# ===========================================
ai_instructions:
  when_to_load: "å½“ç”¨æˆ·æåŠLDCMSã€ä¼ä¸šç½‘ç«™ç®¡ç†ã€å†…å®¹ç®¡ç†ç³»ç»Ÿï¼Œæˆ–æ“ä½œaddons/ldcms/ç›®å½•æ—¶åº”ç«‹å³åŠ è½½æ­¤è§„åˆ™"
  how_to_apply: "ä¸¥æ ¼æŒ‰ç…§LDCMSçš„å¼€å‘è§„èŒƒå’Œæ¶æ„æä¾›å»ºè®®ï¼Œç¡®ä¿ä»£ç ç¬¦åˆæ’ä»¶çš„è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ"
  priority_reason: "LDCMSæ˜¯é¡¹ç›®çš„æ ¸å¿ƒCMSæ’ä»¶ï¼Œå…¶å¼€å‘è§„èŒƒå¯¹æ•´ä¸ªä¼ä¸šç½‘ç«™ç³»ç»Ÿè‡³å…³é‡è¦"
  coordination: "ä¸FastAdminåŸºç¡€è§„èŒƒã€å¤šè¯­è¨€è§„èŒƒå’Œå¤šæ¨¡æ¿è§„èŒƒåè°ƒå·¥ä½œï¼Œç¡®ä¿æ¶æ„ä¸€è‡´æ€§"

# ===========================================
# ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–é…ç½®
# ===========================================
performance:
  preload_conditions: ["æ£€æµ‹åˆ°é¡¹ç›®åŒ…å«addons/ldcmsç›®å½•", "ç”¨æˆ·å†å²æ“ä½œæ¶‰åŠLDCMS"]
  cache_duration: "30"
  unload_conditions: ["è¿ç»­5æ¬¡å¯¹è¯æœªæ¶‰åŠLDCMSç›¸å…³å†…å®¹"]
---

# FastAdmin LDCMS ä¼ä¸šç½‘ç«™ç®¡ç†ç³»ç»Ÿæ ¸å¿ƒå¼€å‘è§„èŒƒ

> **ğŸ¢ é¡¹ç›®å®šä½**: åŸºäºFastAdminæ¡†æ¶çš„LDCMSä¼ä¸šç½‘ç«™ç®¡ç†ç³»ç»Ÿæ’ä»¶
> **ğŸ“¦ æ’ä»¶ç‰ˆæœ¬**: LDCMS v1.4.3
> **ğŸŒ æ ¸å¿ƒç‰¹æ€§**: å¤šè¯­è¨€æ”¯æŒã€å¤šæ¨¡æ¿ç³»ç»Ÿã€è‡ªå®šä¹‰æ¨¡å‹ã€è‡ªå®šä¹‰è¡¨å•ã€UniAppç§»åŠ¨ç«¯
> **ğŸ¯ å¼€å‘é‡ç‚¹**: æ‰€æœ‰åç»­å¼€å‘éƒ½åŸºäºæ­¤LDCMSæ’ä»¶è¿›è¡Œ

## âš ï¸ é‡è¦æé†’

**æœ¬é¡¹ç›®çš„æ‰€æœ‰å¼€å‘å·¥ä½œéƒ½åŸºäºFastAdminçš„LDCMSä¼ä¸šç½‘ç«™ç®¡ç†ç³»ç»Ÿæ’ä»¶è¿›è¡Œï¼**

- ğŸ”¥ **å¿…é¡»ä½¿ç”¨LDCMSæ’ä»¶çš„æ¶æ„å’Œè§„èŒƒ**
- ğŸ”¥ **æ‰€æœ‰åŠŸèƒ½å¼€å‘éƒ½è¦è€ƒè™‘å¤šè¯­è¨€å’Œå¤šæ¨¡æ¿æ”¯æŒ**
- ğŸ”¥ **ä¸¥æ ¼éµå¾ªLDCMSçš„æ•°æ®æ¨¡å‹å’ŒAPIè®¾è®¡**
- ğŸ”¥ **ç¡®ä¿ä¸ç°æœ‰LDCMSåŠŸèƒ½çš„å…¼å®¹æ€§**

---

## ğŸ—ï¸ LDCMSç³»ç»Ÿæ¶æ„

### LDCMSæ’ä»¶æ ¸å¿ƒæ¶æ„ï¼ˆåŸºäºFastAdminï¼‰
```
FastAdmin + LDCMSæ’ä»¶æ¶æ„
â”œâ”€â”€ ğŸ“ addons/ldcms/                    # LDCMSæ’ä»¶æ ¹ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ Ldcms.php                    # æ’ä»¶ä¸»ç±»
â”‚   â”œâ”€â”€ ğŸ“„ config.php                   # æ’ä»¶é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ menu.php                     # åå°èœå•
â”‚   â”œâ”€â”€ ğŸ“ controller/                  # å‰å°æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ Base.php                    # åŸºç¡€æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ Index.php                   # é¦–é¡µæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ Lists.php                   # åˆ—è¡¨é¡µæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ Detail.php                  # è¯¦æƒ…é¡µæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ Search.php                  # æœç´¢æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ Diyform.php                 # è‡ªå®šä¹‰è¡¨å•æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ api/                        # APIæ§åˆ¶å™¨ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ model/                       # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Document.php                # æ–‡æ¡£æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Category.php                # åˆ†ç±»æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Ad.php                      # å¹¿å‘Šæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Langs.php                   # è¯­è¨€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Tags.php                    # æ ‡ç­¾æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Models.php                  # è‡ªå®šä¹‰æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Fields.php                  # è‡ªå®šä¹‰å­—æ®µ
â”‚   â”‚   â”œâ”€â”€ Diyform.php                 # è‡ªå®šä¹‰è¡¨å•
â”‚   â”‚   â””â”€â”€ Links.php                   # å‹æƒ…é“¾æ¥
â”‚   â”œâ”€â”€ ğŸ“ view/                        # æ¨¡æ¿ç›®å½•
â”‚   â”‚   â”œâ”€â”€ default/                    # é»˜è®¤ä¸­æ–‡æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ en/                         # è‹±æ–‡æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ ldcms2024/                  # 2024ä¸»é¢˜
â”‚   â”‚   â”œâ”€â”€ ldcms2024en/                # 2024è‹±æ–‡ä¸»é¢˜
â”‚   â”‚   â”œâ”€â”€ ldcms2025/                  # 2025ä¸»é¢˜
â”‚   â”‚   â””â”€â”€ ldcms2025en/                # 2025è‹±æ–‡ä¸»é¢˜
â”‚   â”œâ”€â”€ ğŸ“ lang/                        # è¯­è¨€åŒ…
â”‚   â”‚   â”œâ”€â”€ zh-cn.php                   # ä¸­æ–‡è¯­è¨€åŒ…
â”‚   â”‚   â”œâ”€â”€ en.php                      # è‹±æ–‡è¯­è¨€åŒ…
â”‚   â”‚   â””â”€â”€ zh-tw.php                   # ç¹ä½“ä¸­æ–‡è¯­è¨€åŒ…
â”‚   â”œâ”€â”€ ğŸ“ utils/                       # å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ Common.php                  # é€šç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ LdRoute.php                 # è·¯ç”±å·¥å…·
â”‚   â”‚   â””â”€â”€ Menu.php                    # èœå•å·¥å…·
â”‚   â”œâ”€â”€ ğŸ“ uniapp/                      # UniAppç§»åŠ¨ç«¯
â”‚   â”œâ”€â”€ ğŸ“„ install.sql                  # å®‰è£…SQL
â”‚   â”œâ”€â”€ ğŸ“„ testdata.sql                 # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ ğŸ“„ info.ini                     # æ’ä»¶ä¿¡æ¯
â””â”€â”€ ğŸ”— ä¸FastAdminæ ¸å¿ƒç³»ç»Ÿé›†æˆ
    â”œâ”€â”€ ç”¨æˆ·æƒé™ç³»ç»Ÿé›†æˆ
    â”œâ”€â”€ åå°ç®¡ç†ç•Œé¢é›†æˆ
    â”œâ”€â”€ æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿé›†æˆ
    â””â”€â”€ ç¼“å­˜ç³»ç»Ÿé›†æˆ
```

### ğŸ”§ é¡¹ç›®ç¯å¢ƒé…ç½®ä¿¡æ¯
```yaml
# FastAdmin LDCMSé¡¹ç›®é…ç½®
é¡¹ç›®åç§°: biubiustar
é¡¹ç›®åŸŸå: biubiustar.local
æ•°æ®åº“å: biubiustar
æ•°æ®åº“ç”¨æˆ·: biubiustar
æ•°æ®åº“å¯†ç : Qwer1234...
æ•°æ®åº“ä¸»æœº: 127.0.0.1:3306
è¡¨å‰ç¼€: fa_

# ğŸ” é‡è¦è®¿é—®åœ°å€
åå°ç®¡ç†åœ°å€: http://biubiustar.local/SWTvGsCQjH.php
å‰å°è®¿é—®åœ°å€: http://biubiustar.local/
LDCMSæ’ä»¶è·¯å¾„: http://biubiustar.local/addons/ldcms/

# ğŸ—‚ï¸ ç›®å½•ç»“æ„
é¡¹ç›®æ ¹ç›®å½•: /Volumes/wwx/dev/WebProjects/biubiustar/
LDCMSæ’ä»¶ç›®å½•: /Volumes/wwx/dev/WebProjects/biubiustar/addons/ldcms/
```

### LDCMSæ’ä»¶æ•°æ®åº“è¡¨ç»“æ„ï¼ˆfa_å‰ç¼€ï¼‰
```sql
-- LDCMSæ ¸å¿ƒæ•°æ®è¡¨ï¼ˆåŸºäºå½“å‰æ•°æ®åº“ï¼šbiubiustarï¼‰
fa_ldcms_document        -- æ–‡æ¡£å†…å®¹è¡¨ï¼ˆæ ¸å¿ƒï¼‰
fa_ldcms_category        -- åˆ†ç±»è¡¨ï¼ˆæ ¸å¿ƒï¼‰
fa_ldcms_ad              -- å¹¿å‘Šè¡¨
fa_ldcms_langs           -- è¯­è¨€é…ç½®è¡¨
fa_ldcms_tags            -- æ ‡ç­¾è¡¨
fa_ldcms_models          -- è‡ªå®šä¹‰æ¨¡å‹è¡¨
fa_ldcms_fields          -- è‡ªå®šä¹‰å­—æ®µè¡¨
fa_ldcms_diyform         -- è‡ªå®šä¹‰è¡¨å•è¡¨
fa_ldcms_diyform_data    -- è¡¨å•æ•°æ®è¡¨
fa_ldcms_diyform_fields  -- è¡¨å•å­—æ®µè¡¨
fa_ldcms_links           -- å‹æƒ…é“¾æ¥è¡¨
```

### æ•°æ®åº“è¡¨ç»“æ„
```sql
-- LDCMSæ ¸å¿ƒæ•°æ®è¡¨
fa_ldcms_ad              -- å¹¿å‘Šè¡¨
fa_ldcms_category        -- åˆ†ç±»è¡¨
fa_ldcms_document        -- æ–‡æ¡£è¡¨
fa_ldcms_langs           -- è¯­è¨€è¡¨
fa_ldcms_tags            -- æ ‡ç­¾è¡¨
fa_ldcms_models          -- è‡ªå®šä¹‰æ¨¡å‹è¡¨
fa_ldcms_fields          -- è‡ªå®šä¹‰å­—æ®µè¡¨
fa_ldcms_diyform         -- è‡ªå®šä¹‰è¡¨å•è¡¨
fa_ldcms_diyform_data    -- è¡¨å•æ•°æ®è¡¨
fa_ldcms_diyform_fields  -- è¡¨å•å­—æ®µè¡¨
fa_ldcms_links           -- å‹æƒ…é“¾æ¥è¡¨
```

---

## ğŸŒ å¤šè¯­è¨€å¼€å‘è§„èŒƒ

### è¯­è¨€é…ç½®æ ‡å‡†
```php
/**
 * è¯­è¨€é…ç½®ç®¡ç†
 */
class LanguageManager
{
    /**
     * è·å–æ”¯æŒçš„è¯­è¨€åˆ—è¡¨
     */
    public static function getSupportedLanguages()
    {
        return [
            'zh-cn' => [
                'name' => 'ç®€ä½“ä¸­æ–‡',
                'locale' => 'zh-CN',
                'flag' => 'cn',
                'default' => true
            ],
            'en' => [
                'name' => 'English',
                'locale' => 'en-US', 
                'flag' => 'us',
                'default' => false
            ],
            'zh-tw' => [
                'name' => 'ç¹é«”ä¸­æ–‡',
                'locale' => 'zh-TW',
                'flag' => 'tw',
                'default' => false
            ]
        ];
    }
    
    /**
     * è·å–å½“å‰è¯­è¨€
     */
    public static function getCurrentLang()
    {
        $lang = request()->param('lang', '');
        if (empty($lang)) {
            $lang = cookie('ldcms_lang') ?: 'zh-cn';
        }
        
        // éªŒè¯è¯­è¨€æ˜¯å¦æ”¯æŒ
        $supportedLangs = array_keys(self::getSupportedLanguages());
        if (!in_array($lang, $supportedLangs)) {
            $lang = 'zh-cn';
        }
        
        return $lang;
    }
    
    /**
     * è®¾ç½®å½“å‰è¯­è¨€
     */
    public static function setCurrentLang($lang)
    {
        $supportedLangs = array_keys(self::getSupportedLanguages());
        if (in_array($lang, $supportedLangs)) {
            cookie('ldcms_lang', $lang, 86400 * 30); // 30å¤©
            return true;
        }
        return false;
    }
    
    /**
     * è·å–å¤šè¯­è¨€å†…å®¹
     */
    public static function getMultiLangContent($table, $conditions = [])
    {
        $lang = self::getCurrentLang();
        $conditions['lang'] = $lang;
        
        return \think\Db::name($table)->where($conditions)->select();
    }
}
```

### å¤šè¯­è¨€æ•°æ®æ¨¡å‹è§„èŒƒ
```php
/**
 * å¤šè¯­è¨€æ¨¡å‹åŸºç±»
 */
abstract class MultiLangModel extends \think\Model
{
    // è‡ªåŠ¨å†™å…¥è¯­è¨€å­—æ®µ
    protected $autoWriteTimestamp = 'int';
    protected $createTime = 'create_time';
    protected $updateTime = 'update_time';
    
    /**
     * æ’å…¥æ•°æ®æ—¶è‡ªåŠ¨æ·»åŠ è¯­è¨€æ ‡è¯†
     */
    protected function initialize()
    {
        parent::initialize();
        
        // è‡ªåŠ¨è®¾ç½®è¯­è¨€
        $this->withAttr('lang', function($value, $data) {
            return $value ?: LanguageManager::getCurrentLang();
        });
    }
    
    /**
     * è·å–æŒ‡å®šè¯­è¨€çš„æ•°æ®
     */
    public function scopeLang($query, $lang = '')
    {
        $lang = $lang ?: LanguageManager::getCurrentLang();
        return $query->where('lang', $lang);
    }
    
    /**
     * è·å–æ‰€æœ‰è¯­è¨€ç‰ˆæœ¬
     */
    public function getAllLangVersions($id)
    {
        return $this->where('id', $id)->select();
    }
    
    /**
     * å¤åˆ¶åˆ°å…¶ä»–è¯­è¨€
     */
    public function copyToLang($id, $targetLang, $fields = [])
    {
        $sourceData = $this->find($id);
        if (!$sourceData) {
            return false;
        }
        
        $newData = $sourceData->toArray();
        unset($newData['id']);
        $newData['lang'] = $targetLang;
        
        // æ›´æ–°æŒ‡å®šå­—æ®µ
        foreach ($fields as $field => $value) {
            $newData[$field] = $value;
        }
        
        return $this->create($newData);
    }
}

/**
 * åˆ†ç±»æ¨¡å‹
 */
class Category extends MultiLangModel
{
    protected $name = 'ldcms_category';
    
    /**
     * è·å–åˆ†ç±»æ ‘
     */
    public function getCategoryTree($pid = 0, $lang = '')
    {
        $lang = $lang ?: LanguageManager::getCurrentLang();
        
        $categories = $this->where('pid', $pid)
                          ->where('lang', $lang)
                          ->where('status', 1)
                          ->order('sort asc, id asc')
                          ->select();
        
        foreach ($categories as &$category) {
            $category['children'] = $this->getCategoryTree($category['id'], $lang);
        }
        
        return $categories;
    }
    
    /**
     * è·å–é¢åŒ…å±‘å¯¼èˆª
     */
    public function getBreadcrumb($id, $lang = '')
    {
        $lang = $lang ?: LanguageManager::getCurrentLang();
        $breadcrumb = [];
        
        while ($id > 0) {
            $category = $this->where('id', $id)
                            ->where('lang', $lang)
                            ->find();
            if ($category) {
                array_unshift($breadcrumb, $category);
                $id = $category['pid'];
            } else {
                break;
            }
        }
        
        return $breadcrumb;
    }
}
```

---

## ğŸ¨ å¤šæ¨¡æ¿ç³»ç»Ÿè§„èŒƒ

### æ¨¡æ¿ç»“æ„æ ‡å‡†
```
addons/ldcms/view/
â”œâ”€â”€ default/           # é»˜è®¤ä¸­æ–‡æ¨¡æ¿
â”‚   â”œâ”€â”€ index/        # é¦–é¡µæ¨¡æ¿
â”‚   â”œâ”€â”€ lists/        # åˆ—è¡¨é¡µæ¨¡æ¿
â”‚   â”œâ”€â”€ detail/       # è¯¦æƒ…é¡µæ¨¡æ¿
â”‚   â”œâ”€â”€ search/       # æœç´¢é¡µæ¨¡æ¿
â”‚   â””â”€â”€ common/       # å…¬å…±æ¨¡æ¿
â”œâ”€â”€ en/               # è‹±æ–‡æ¨¡æ¿
â”œâ”€â”€ ldcms2024/        # 2024ä¸»é¢˜ä¸­æ–‡ç‰ˆ
â”œâ”€â”€ ldcms2024en/      # 2024ä¸»é¢˜è‹±æ–‡ç‰ˆ
â”œâ”€â”€ ldcms2025/        # 2025ä¸»é¢˜ä¸­æ–‡ç‰ˆ
â””â”€â”€ ldcms2025en/      # 2025ä¸»é¢˜è‹±æ–‡ç‰ˆ
```

### æ¨¡æ¿å¼€å‘è§„èŒƒ
```php
/**
 * æ¨¡æ¿ç®¡ç†å™¨
 */
class TemplateManager
{
    /**
     * è·å–å½“å‰æ¨¡æ¿
     */
    public static function getCurrentTemplate()
    {
        $config = get_addon_config('ldcms');
        $lang = LanguageManager::getCurrentLang();
        
        // æ ¹æ®è¯­è¨€é€‰æ‹©æ¨¡æ¿
        $templateMap = [
            'zh-cn' => $config['template'] ?: 'default',
            'en' => $config['en_template'] ?: 'en',
            'zh-tw' => $config['tw_template'] ?: 'default'
        ];
        
        return $templateMap[$lang] ?? 'default';
    }
    
    /**
     * è·å–æ¨¡æ¿è·¯å¾„
     */
    public static function getTemplatePath($template = '', $view = '')
    {
        $template = $template ?: self::getCurrentTemplate();
        $basePath = ADDON_PATH . 'ldcms/view/' . $template . '/';
        
        return $view ? $basePath . $view : $basePath;
    }
    
    /**
     * æ£€æŸ¥æ¨¡æ¿æ˜¯å¦å­˜åœ¨
     */
    public static function templateExists($template, $view)
    {
        $templatePath = self::getTemplatePath($template, $view . '.html');
        return file_exists($templatePath);
    }
    
    /**
     * è·å–æ¨¡æ¿é…ç½®
     */
    public static function getTemplateConfig($template)
    {
        $configFile = self::getTemplatePath($template, 'config.php');
        
        if (file_exists($configFile)) {
            return include $configFile;
        }
        
        return [
            'name' => $template,
            'title' => 'é»˜è®¤æ¨¡æ¿',
            'description' => 'é»˜è®¤æ¨¡æ¿æè¿°',
            'author' => 'LDCMS',
            'version' => '1.0.0'
        ];
    }
}
```

### æ¨¡æ¿æ ‡ç­¾ç³»ç»Ÿ
```html
<!-- LDCMSæ¨¡æ¿æ ‡ç­¾ä½¿ç”¨è§„èŒƒ -->

<!-- åˆ†ç±»åˆ—è¡¨æ ‡ç­¾ -->
{ldcms:category pid="0" limit="10" order="sort asc"}
<ul class="nav-menu">
    {volist name="category_list" id="vo"}
    <li><a href="{$vo.url}">{$vo.name}</a></li>
    {/volist}
</ul>
{/ldcms:category}

<!-- æ–‡æ¡£åˆ—è¡¨æ ‡ç­¾ -->
{ldcms:document cid="1" limit="5" order="create_time desc"}
<div class="news-list">
    {volist name="document_list" id="vo"}
    <div class="news-item">
        <h3><a href="{$vo.url}">{$vo.title}</a></h3>
        <p>{$vo.description}</p>
        <time>{$vo.create_time|date='Y-m-d'}</time>
    </div>
    {/volist}
</div>
{/ldcms:document}

<!-- å¹¿å‘Šæ ‡ç­¾ -->
{ldcms:ad type="banner" limit="5"}
<div class="banner-slider">
    {volist name="ad_list" id="vo"}
    <div class="slide">
        <img src="{$vo.image}" alt="{$vo.title}">
        <div class="caption">
            <h2>{$vo.title}</h2>
            <p>{$vo.description}</p>
        </div>
    </div>
    {/volist}
</div>
{/ldcms:ad}

<!-- è‡ªå®šä¹‰å­—æ®µæ ‡ç­¾ -->
{ldcms:fields model="article" id="$document.id"}
<div class="custom-fields">
    {volist name="fields_data" id="field"}
    <div class="field-item">
        <label>{$field.title}:</label>
        <span>{$field.value}</span>
    </div>
    {/volist}
</div>
{/ldcms:fields}
```

---

## ğŸ“ å†…å®¹ç®¡ç†å¼€å‘è§„èŒƒ

### æ–‡æ¡£æ¨¡å‹è§„èŒƒ
```php
/**
 * æ–‡æ¡£æ¨¡å‹
 */
class Document extends MultiLangModel
{
    protected $name = 'ldcms_document';
    
    protected $append = [
        'url',
        'thumb_url',
        'category_name'
    ];
    
    /**
     * è·å–æ–‡æ¡£URL
     */
    public function getUrlAttr($value, $data)
    {
        $config = get_addon_config('ldcms');
        $domain = $config['main_domain'] ?: request()->domain();
        
        // URLç”Ÿæˆè§„åˆ™
        if ($data['outlink']) {
            return $data['outlink'];
        }
        
        $category = \addons\ldcms\model\Category::find($data['cid']);
        if ($category && $category['outlink']) {
            return $category['outlink'];
        }
        
        // ç”Ÿæˆå‹å¥½URL
        $lang = $data['lang'] ?? 'zh-cn';
        $langPrefix = $lang === 'zh-cn' ? '' : '/' . $lang;
        
        return $domain . $langPrefix . '/detail/' . $data['id'] . '.html';
    }
    
    /**
     * è·å–ç¼©ç•¥å›¾URL
     */
    public function getThumbUrlAttr($value, $data)
    {
        $images = $data['images'] ?? '';
        if ($images) {
            $imageArray = explode(',', $images);
            return cdnurl($imageArray[0], true);
        }
        
        return '/assets/addons/ldcms/img/default-thumb.jpg';
    }
    
    /**
     * è·å–åˆ†ç±»åç§°
     */
    public function getCategoryNameAttr($value, $data)
    {
        $category = \addons\ldcms\model\Category::find($data['cid']);
        return $category ? $category['name'] : '';
    }
    
    /**
     * å…³è”åˆ†ç±»
     */
    public function category()
    {
        return $this->belongsTo(Category::class, 'cid', 'id');
    }
    
    /**
     * å…³è”æ ‡ç­¾
     */
    public function tags()
    {
        return $this->belongsToMany(Tags::class, 'ldcms_document_tags', 'tag_id', 'document_id');
    }
    
    /**
     * è·å–ç›¸å…³æ–‡æ¡£
     */
    public function getRelatedDocuments($id, $limit = 5)
    {
        $document = $this->find($id);
        if (!$document) {
            return [];
        }
        
        return $this->where('cid', $document['cid'])
                   ->where('id', '<>', $id)
                   ->where('lang', $document['lang'])
                   ->where('status', 1)
                   ->limit($limit)
                   ->order('create_time desc')
                   ->select();
    }
    
    /**
     * å¢åŠ æµè§ˆé‡
     */
    public function incrementViews($id)
    {
        return $this->where('id', $id)->setInc('views');
    }
}
```

### SEOä¼˜åŒ–è§„èŒƒ
```php
/**
 * SEOç®¡ç†å™¨
 */
class SEOManager
{
    /**
     * ç”Ÿæˆé¡µé¢SEOä¿¡æ¯
     */
    public static function generateSEO($type, $data = [])
    {
        $config = get_addon_config('ldcms');
        $lang = LanguageManager::getCurrentLang();
        
        $seo = [
            'title' => $config['site_name'] ?? 'LDCMSä¼ä¸šç½‘ç«™',
            'keywords' => $config['site_keywords'] ?? '',
            'description' => $config['site_description'] ?? ''
        ];
        
        switch ($type) {
            case 'index':
                // é¦–é¡µSEO
                $seo['title'] = $config['site_name'] ?? 'LDCMSä¼ä¸šç½‘ç«™';
                break;
                
            case 'category':
                // åˆ†ç±»é¡µSEO
                if (isset($data['category'])) {
                    $category = $data['category'];
                    $seo['title'] = $category['seo_title'] ?: $category['name'];
                    $seo['keywords'] = $category['seo_keywords'];
                    $seo['description'] = $category['seo_description'];
                }
                break;
                
            case 'document':
                // æ–‡æ¡£é¡µSEO
                if (isset($data['document'])) {
                    $document = $data['document'];
                    $seo['title'] = $document['seo_title'] ?: $document['title'];
                    $seo['keywords'] = $document['seo_keywords'];
                    $seo['description'] = $document['seo_description'] ?: 
                                        mb_substr(strip_tags($document['content']), 0, 150);
                }
                break;
        }
        
        // å¤šè¯­è¨€SEOå¤„ç†
        if ($lang !== 'zh-cn') {
            $langConfig = $config['lang_' . str_replace('-', '_', $lang)] ?? [];
            if (!empty($langConfig['site_name'])) {
                $seo['title'] .= ' - ' . $langConfig['site_name'];
            }
        }
        
        return $seo;
    }
    
    /**
     * ç”Ÿæˆç»“æ„åŒ–æ•°æ®
     */
    public static function generateStructuredData($type, $data = [])
    {
        $structuredData = [];
        
        switch ($type) {
            case 'organization':
                $structuredData = [
                    '@context' => 'https://schema.org',
                    '@type' => 'Organization',
                    'name' => $data['name'] ?? '',
                    'url' => $data['url'] ?? '',
                    'logo' => $data['logo'] ?? ''
                ];
                break;
                
            case 'article':
                $structuredData = [
                    '@context' => 'https://schema.org',
                    '@type' => 'Article',
                    'headline' => $data['title'] ?? '',
                    'description' => $data['description'] ?? '',
                    'author' => [
                        '@type' => 'Organization',
                        'name' => $data['author'] ?? ''
                    ],
                    'datePublished' => $data['create_time'] ?? '',
                    'dateModified' => $data['update_time'] ?? ''
                ];
                break;
        }
        
        return json_encode($structuredData, JSON_UNESCAPED_UNICODE);
    }
}
```

---

## ğŸ”§ è‡ªå®šä¹‰åŠŸèƒ½å¼€å‘è§„èŒƒ

### è‡ªå®šä¹‰æ¨¡å‹è§„èŒƒ
```php
/**
 * è‡ªå®šä¹‰æ¨¡å‹ç®¡ç†å™¨
 */
class CustomModelManager
{
    /**
     * åˆ›å»ºè‡ªå®šä¹‰æ¨¡å‹
     */
    public static function createModel($data)
    {
        // éªŒè¯æ•°æ®
        $validate = [
            'name' => 'require|unique:ldcms_models',
            'title' => 'require',
            'table_name' => 'require|unique:ldcms_models'
        ];
        
        $validator = new \think\Validate($validate);
        if (!$validator->check($data)) {
            throw new \Exception($validator->getError());
        }
        
        // åˆ›å»ºæ¨¡å‹è®°å½•
        $modelId = \think\Db::name('ldcms_models')->insertGetId([
            'name' => $data['name'],
            'title' => $data['title'],
            'table_name' => $data['table_name'],
            'description' => $data['description'] ?? '',
            'status' => 1,
            'create_time' => time(),
            'update_time' => time()
        ]);
        
        // åˆ›å»ºå¯¹åº”æ•°æ®è¡¨
        self::createModelTable($data['table_name']);
        
        return $modelId;
    }
    
    /**
     * åˆ›å»ºæ¨¡å‹æ•°æ®è¡¨
     */
    private static function createModelTable($tableName)
    {
        $sql = "CREATE TABLE IF NOT EXISTS `{$tableName}` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `title` varchar(255) NOT NULL DEFAULT '' COMMENT 'æ ‡é¢˜',
            `content` longtext COMMENT 'å†…å®¹',
            `images` text COMMENT 'å›¾ç‰‡',
            `sort` int(10) DEFAULT '99' COMMENT 'æ’åº',
            `status` tinyint(1) DEFAULT '1' COMMENT 'çŠ¶æ€',
            `lang` varchar(10) NOT NULL DEFAULT 'zh-cn' COMMENT 'è¯­è¨€',
            `create_time` bigint(20) DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
            `update_time` bigint(20) DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
            PRIMARY KEY (`id`),
            KEY `status` (`status`),
            KEY `lang` (`lang`),
            KEY `sort` (`sort`)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è‡ªå®šä¹‰æ¨¡å‹è¡¨';";
        
        \think\Db::execute($sql);
    }
    
    /**
     * ä¸ºæ¨¡å‹æ·»åŠ å­—æ®µ
     */
    public static function addField($modelId, $fieldData)
    {
        // éªŒè¯å­—æ®µæ•°æ®
        $validate = [
            'name' => 'require',
            'title' => 'require',
            'type' => 'require|in:text,textarea,number,select,radio,checkbox,image,file,date,datetime'
        ];
        
        $validator = new \think\Validate($validate);
        if (!$validator->check($fieldData)) {
            throw new \Exception($validator->getError());
        }
        
        // è·å–æ¨¡å‹ä¿¡æ¯
        $model = \think\Db::name('ldcms_models')->find($modelId);
        if (!$model) {
            throw new \Exception('æ¨¡å‹ä¸å­˜åœ¨');
        }
        
        // æ·»åŠ å­—æ®µè®°å½•
        $fieldId = \think\Db::name('ldcms_fields')->insertGetId([
            'model_id' => $modelId,
            'name' => $fieldData['name'],
            'title' => $fieldData['title'],
            'type' => $fieldData['type'],
            'options' => $fieldData['options'] ?? '',
            'default_value' => $fieldData['default_value'] ?? '',
            'required' => $fieldData['required'] ?? 0,
            'sort' => $fieldData['sort'] ?? 99,
            'status' => 1,
            'create_time' => time(),
            'update_time' => time()
        ]);
        
        // åœ¨æ•°æ®è¡¨ä¸­æ·»åŠ å­—æ®µ
        self::addTableField($model['table_name'], $fieldData);
        
        return $fieldId;
    }
    
    /**
     * åœ¨æ•°æ®è¡¨ä¸­æ·»åŠ å­—æ®µ
     */
    private static function addTableField($tableName, $fieldData)
    {
        $fieldType = self::getFieldSQLType($fieldData['type']);
        $sql = "ALTER TABLE `{$tableName}` ADD COLUMN `{$fieldData['name']}` {$fieldType} COMMENT '{$fieldData['title']}'";
        
        \think\Db::execute($sql);
    }
    
    /**
     * è·å–å­—æ®µSQLç±»å‹
     */
    private static function getFieldSQLType($type)
    {
        $typeMap = [
            'text' => 'varchar(255) DEFAULT \'\'',
            'textarea' => 'text',
            'number' => 'int(11) DEFAULT 0',
            'select' => 'varchar(100) DEFAULT \'\'',
            'radio' => 'varchar(100) DEFAULT \'\'',
            'checkbox' => 'text',
            'image' => 'varchar(255) DEFAULT \'\'',
            'file' => 'varchar(255) DEFAULT \'\'',
            'date' => 'date DEFAULT NULL',
            'datetime' => 'datetime DEFAULT NULL'
        ];
        
        return $typeMap[$type] ?? 'varchar(255) DEFAULT \'\'';
    }
}
```

### è‡ªå®šä¹‰è¡¨å•è§„èŒƒ
```php
/**
 * è‡ªå®šä¹‰è¡¨å•ç®¡ç†å™¨
 */
class CustomFormManager
{
    /**
     * åˆ›å»ºè‡ªå®šä¹‰è¡¨å•
     */
    public static function createForm($data)
    {
        // åˆ›å»ºè¡¨å•è®°å½•
        $formId = \think\Db::name('ldcms_diyform')->insertGetId([
            'name' => $data['name'],
            'title' => $data['title'],
            'description' => $data['description'] ?? '',
            'template' => $data['template'] ?? 'default',
            'success_message' => $data['success_message'] ?? 'æäº¤æˆåŠŸ',
            'email_notify' => $data['email_notify'] ?? 0,
            'notify_email' => $data['notify_email'] ?? '',
            'status' => 1,
            'create_time' => time(),
            'update_time' => time()
        ]);
        
        return $formId;
    }
    
    /**
     * æ·»åŠ è¡¨å•å­—æ®µ
     */
    public static function addFormField($formId, $fieldData)
    {
        return \think\Db::name('ldcms_diyform_fields')->insertGetId([
            'form_id' => $formId,
            'name' => $fieldData['name'],
            'title' => $fieldData['title'],
            'type' => $fieldData['type'],
            'options' => $fieldData['options'] ?? '',
            'placeholder' => $fieldData['placeholder'] ?? '',
            'required' => $fieldData['required'] ?? 0,
            'validation' => $fieldData['validation'] ?? '',
            'sort' => $fieldData['sort'] ?? 99,
            'status' => 1,
            'create_time' => time(),
            'update_time' => time()
        ]);
    }
    
    /**
     * æäº¤è¡¨å•æ•°æ®
     */
    public static function submitForm($formId, $data)
    {
        // è·å–è¡¨å•é…ç½®
        $form = \think\Db::name('ldcms_diyform')->find($formId);
        if (!$form || $form['status'] != 1) {
            throw new \Exception('è¡¨å•ä¸å­˜åœ¨æˆ–å·²ç¦ç”¨');
        }
        
        // è·å–è¡¨å•å­—æ®µ
        $fields = \think\Db::name('ldcms_diyform_fields')
                          ->where('form_id', $formId)
                          ->where('status', 1)
                          ->order('sort asc')
                          ->select();
        
        // éªŒè¯æ•°æ®
        foreach ($fields as $field) {
            if ($field['required'] && empty($data[$field['name']])) {
                throw new \Exception($field['title'] . 'ä¸èƒ½ä¸ºç©º');
            }
            
            // è‡ªå®šä¹‰éªŒè¯è§„åˆ™
            if ($field['validation'] && !empty($data[$field['name']])) {
                if (!self::validateField($data[$field['name']], $field['validation'])) {
                    throw new \Exception($field['title'] . 'æ ¼å¼ä¸æ­£ç¡®');
                }
            }
        }
        
        // ä¿å­˜æäº¤æ•°æ®
        $submitId = \think\Db::name('ldcms_diyform_data')->insertGetId([
            'form_id' => $formId,
            'data' => json_encode($data, JSON_UNESCAPED_UNICODE),
            'ip' => request()->ip(),
            'user_agent' => request()->header('User-Agent'),
            'create_time' => time()
        ]);
        
        // é‚®ä»¶é€šçŸ¥
        if ($form['email_notify'] && $form['notify_email']) {
            self::sendEmailNotification($form, $data);
        }
        
        return $submitId;
    }
    
    /**
     * å­—æ®µéªŒè¯
     */
    private static function validateField($value, $validation)
    {
        switch ($validation) {
            case 'email':
                return filter_var($value, FILTER_VALIDATE_EMAIL) !== false;
            case 'phone':
                return preg_match('/^1[3-9]\d{9}$/', $value);
            case 'url':
                return filter_var($value, FILTER_VALIDATE_URL) !== false;
            case 'number':
                return is_numeric($value);
            default:
                return true;
        }
    }
    
    /**
     * å‘é€é‚®ä»¶é€šçŸ¥
     */
    private static function sendEmailNotification($form, $data)
    {
        $subject = 'æ–°çš„è¡¨å•æäº¤ï¼š' . $form['title'];
        $body = "è¡¨å•åç§°ï¼š{$form['title']}\n";
        $body .= "æäº¤æ—¶é—´ï¼š" . date('Y-m-d H:i:s') . "\n";
        $body .= "æäº¤IPï¼š" . request()->ip() . "\n\n";
        
        foreach ($data as $key => $value) {
            $body .= "{$key}ï¼š{$value}\n";
        }
        
        // è¿™é‡Œè°ƒç”¨é‚®ä»¶å‘é€æœåŠ¡
        // \app\common\library\Email::send($form['notify_email'], $subject, $body);
    }
}
```

---

## ğŸ“± UniAppç§»åŠ¨ç«¯å¼€å‘è§„èŒƒ

### APIæ¥å£è§„èŒƒ
```php
/**
 * LDCMS APIæ§åˆ¶å™¨åŸºç±»
 */
abstract class LdcmsApiController extends \app\common\controller\Api
{
    protected $noNeedLogin = [];
    protected $noNeedRight = [];
    
    protected function initialize()
    {
        parent::initialize();
        
        // APIå¼€å…³æ£€æŸ¥
        $config = get_addon_config('ldcms');
        if (!$config['api_site']) {
            $this->error('APIæœåŠ¡æœªå¼€å¯', null, 403);
        }
        
        // APIè®¤è¯æ£€æŸ¥
        if ($config['api_auth']) {
            $this->checkApiAuth();
        }
        
        // è¯­è¨€è®¾ç½®
        $lang = $this->request->header('Accept-Language', 'zh-cn');
        LanguageManager::setCurrentLang($lang);
    }
    
    /**
     * APIè®¤è¯æ£€æŸ¥
     */
    protected function checkApiAuth()
    {
        $config = get_addon_config('ldcms');
        $appid = $this->request->header('X-App-Id');
        $timestamp = $this->request->header('X-Timestamp');
        $signature = $this->request->header('X-Signature');
        
        if (!$appid || !$timestamp || !$signature) {
            $this->error('APIè®¤è¯å‚æ•°ç¼ºå¤±', null, 401);
        }
        
        // éªŒè¯æ—¶é—´æˆ³ï¼ˆ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰
        if (abs(time() - $timestamp) > 300) {
            $this->error('è¯·æ±‚æ—¶é—´æˆ³æ— æ•ˆ', null, 401);
        }
        
        // éªŒè¯ç­¾å
        $expectedSignature = md5($appid . $timestamp . $config['api_secret']);
        if ($signature !== $expectedSignature) {
            $this->error('APIç­¾åéªŒè¯å¤±è´¥', null, 401);
        }
    }
    
    /**
     * ç»Ÿä¸€APIå“åº”æ ¼å¼
     */
    protected function apiSuccess($message = 'success', $data = [], $code = 200)
    {
        return json([
            'code' => $code,
            'message' => $message,
            'data' => $data,
            'timestamp' => time()
        ]);
    }
    
    protected function apiError($message = 'error', $data = [], $code = 400)
    {
        return json([
            'code' => $code,
            'message' => $message,
            'data' => $data,
            'timestamp' => time()
        ]);
    }
}

/**
 * å†…å®¹APIæ§åˆ¶å™¨
 */
class ContentApiController extends LdcmsApiController
{
    /**
     * è·å–åˆ†ç±»åˆ—è¡¨
     */
    public function categories()
    {
        $pid = $this->request->param('pid', 0, 'intval');
        $lang = $this->request->param('lang', 'zh-cn');
        
        $categories = \addons\ldcms\model\Category::where('pid', $pid)
                                                 ->where('lang', $lang)
                                                 ->where('status', 1)
                                                 ->field('id,name,ename,image,sort,pid')
                                                 ->order('sort asc, id asc')
                                                 ->select();
        
        return $this->apiSuccess('è·å–æˆåŠŸ', $categories);
    }
    
    /**
     * è·å–æ–‡æ¡£åˆ—è¡¨
     */
    public function documents()
    {
        $cid = $this->request->param('cid', 0, 'intval');
        $page = $this->request->param('page', 1, 'intval');
        $limit = $this->request->param('limit', 10, 'intval');
        $lang = $this->request->param('lang', 'zh-cn');
        
        $limit = min($limit, 50); // é™åˆ¶æ¯é¡µæœ€å¤§æ•°é‡
        
        $documents = \addons\ldcms\model\Document::where('cid', $cid)
                                                ->where('lang', $lang)
                                                ->where('status', 1)
                                                ->field('id,title,description,images,create_time,views')
                                                ->order('create_time desc')
                                                ->page($page, $limit)
                                                ->select();
        
        $total = \addons\ldcms\model\Document::where('cid', $cid)
                                            ->where('lang', $lang)
                                            ->where('status', 1)
                                            ->count();
        
        return $this->apiSuccess('è·å–æˆåŠŸ', [
            'list' => $documents,
            'total' => $total,
            'page' => $page,
            'limit' => $limit
        ]);
    }
    
    /**
     * è·å–æ–‡æ¡£è¯¦æƒ…
     */
    public function documentDetail()
    {
        $id = $this->request->param('id', 0, 'intval');
        
        if (!$id) {
            return $this->apiError('å‚æ•°é”™è¯¯');
        }
        
        $document = \addons\ldcms\model\Document::with(['category'])
                                              ->find($id);
        
        if (!$document || $document['status'] != 1) {
            return $this->apiError('æ–‡æ¡£ä¸å­˜åœ¨');
        }
        
        // å¢åŠ æµè§ˆé‡
        $document->incrementViews($id);
        
        return $this->apiSuccess('è·å–æˆåŠŸ', $document);
    }
}
```

### UniAppé¡µé¢å¼€å‘è§„èŒƒ
```javascript
// pages/index/index.js - UniAppé¡µé¢ç¤ºä¾‹
export default {
    data() {
        return {
            categories: [],
            bannerList: [],
            newsList: [],
            loading: false,
            lang: 'zh-cn'
        }
    },
    
    onLoad() {
        this.initPage();
    },
    
    methods: {
        async initPage() {
            this.loading = true;
            
            try {
                await Promise.all([
                    this.loadCategories(),
                    this.loadBanners(),
                    this.loadNews()
                ]);
            } catch (error) {
                this.showError('åŠ è½½å¤±è´¥ï¼š' + error.message);
            } finally {
                this.loading = false;
            }
        },
        
        async loadCategories() {
            const response = await this.$api.get('/ldcms/api/categories', {
                pid: 0,
                lang: this.lang
            });
            
            if (response.code === 200) {
                this.categories = response.data;
            }
        },
        
        async loadBanners() {
            const response = await this.$api.get('/ldcms/api/ads', {
                type: 'banner',
                limit: 5,
                lang: this.lang
            });
            
            if (response.code === 200) {
                this.bannerList = response.data;
            }
        },
        
        async loadNews() {
            const response = await this.$api.get('/ldcms/api/documents', {
                cid: 1, // æ–°é—»åˆ†ç±»ID
                limit: 10,
                lang: this.lang
            });
            
            if (response.code === 200) {
                this.newsList = response.data.list;
            }
        },
        
        switchLanguage(lang) {
            this.lang = lang;
            uni.setStorageSync('language', lang);
            this.initPage();
        },
        
        showError(message) {
            uni.showToast({
                title: message,
                icon: 'none',
                duration: 2000
            });
        }
    }
}
```

---

## ğŸ“‹ LDCMSå¼€å‘æ£€æŸ¥æ¸…å•

### åŠŸèƒ½å¼€å‘æ£€æŸ¥
- [ ] å¤šè¯­è¨€æ”¯æŒæ­£ç¡®å®ç°
- [ ] æ¨¡æ¿åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
- [ ] SEOä¿¡æ¯å®Œæ•´è®¾ç½®
- [ ] URLé‡å†™è§„åˆ™æ­£ç¡®
- [ ] è‡ªå®šä¹‰æ¨¡å‹åŠŸèƒ½æµ‹è¯•
- [ ] è‡ªå®šä¹‰è¡¨å•æäº¤æ­£å¸¸
- [ ] APIæ¥å£è¿”å›æ ¼å¼ç»Ÿä¸€
- [ ] ç§»åŠ¨ç«¯é€‚é…å®Œæˆ
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] ç¼“å­˜æœºåˆ¶æ­£ç¡®é…ç½®

### æ•°æ®å®‰å…¨æ£€æŸ¥
- [ ] è¾“å…¥æ•°æ®è¿‡æ»¤å’ŒéªŒè¯
- [ ] SQLæ³¨å…¥é˜²æŠ¤æªæ–½
- [ ] XSSæ”»å‡»é˜²æŠ¤
- [ ] æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥
- [ ] APIæ¥å£æƒé™æ§åˆ¶
- [ ] æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- [ ] æ—¥å¿—è®°å½•å®Œæ•´
- [ ] é”™è¯¯ä¿¡æ¯ä¸æ³„éœ²æ•æ„Ÿæ•°æ®

### æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] å›¾ç‰‡å‹ç¼©å’ŒCDN
- [ ] é™æ€èµ„æºç¼“å­˜
- [ ] é¡µé¢åŠ è½½é€Ÿåº¦ä¼˜åŒ–
- [ ] APIæ¥å£å“åº”æ—¶é—´
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- [ ] æ•°æ®åº“è¿æ¥æ± é…ç½®

### å¤šè¯­è¨€æ£€æŸ¥
- [ ] è¯­è¨€åŒ…ç¿»è¯‘å®Œæ•´
- [ ] URLå¤šè¯­è¨€æ”¯æŒ
- [ ] æ¨¡æ¿å¤šè¯­è¨€é€‚é…
- [ ] æ•°æ®åº“å¤šè¯­è¨€å­—æ®µ
- [ ] SEOå¤šè¯­è¨€ä¼˜åŒ–
- [ ] æ—¶é—´æ ¼å¼æœ¬åœ°åŒ–
- [ ] è´§å¸æ ¼å¼æœ¬åœ°åŒ–

### æ¨¡æ¿ç³»ç»Ÿæ£€æŸ¥
- [ ] æ¨¡æ¿æ–‡ä»¶ç»“æ„è§„èŒƒ
- [ ] æ¨¡æ¿æ ‡ç­¾ä½¿ç”¨æ­£ç¡®
- [ ] å“åº”å¼è®¾è®¡å®ç°
- [ ] æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
- [ ] ç§»åŠ¨ç«¯æ˜¾ç¤ºæ­£å¸¸
- [ ] æ¨¡æ¿åˆ‡æ¢åŠŸèƒ½
- [ ] è‡ªå®šä¹‰æ¨¡æ¿å¼€å‘

---

**æ³¨æ„**: LDCMSæ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„ä¼ä¸šç½‘ç«™ç®¡ç†ç³»ç»Ÿï¼Œå¼€å‘æ—¶åº”å……åˆ†åˆ©ç”¨å…¶å¤šè¯­è¨€ã€å¤šæ¨¡æ¿ã€è‡ªå®šä¹‰åŠŸèƒ½ç­‰ç‰¹æ€§ï¼Œç¡®ä¿ç³»ç»Ÿçš„æ‰©å±•æ€§å’Œç”¨æˆ·ä½“éªŒã€‚